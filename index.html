<!DOCTYPE html>

<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–†–µ—Ü–µ–ø—Ç–ë–æ—Ç Web App</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

  <style>

    html, body {
  overscroll-behavior: contain;
}


h1, h2, h3 {
  font-family: 'Lobster', cursive;
  color: #4b2c5e;
}


  


    h1, h2, h3 {
      color: #4b2c5e;
    }

    .section {
      display: none;
      animation: fade 0.4s ease;
    }

    .active {
      display: block !important;
    }

    .scroll-menu {
      overflow-x: auto;
      white-space: nowrap;
      padding: 10px 0;
      display: flex;
      gap: 10px;
    }

    .scroll-menu button {
      background: linear-gradient(to right, #fbc2eb, #a6c1ee);
      border: none;
      border-radius: 25px;
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease;
    }

    .scroll-menu button:hover {
      transform: scale(1.05);
    }

    .recipe-card {
      background: #fff;
      border-radius: 16px;
      padding: 20px;
      margin: 15px 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    @keyframes pulseHighlight {
  0% { transform: scale(1); }
  50% { transform: scale(1.01); }
  100% { transform: scale(1); }
}

    
    .bottom-nav {
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      overflow-x: auto;
    }

   .bottom-nav button {
  background: transparent;
  border: none;
  font-size: 16px;
  font-weight: bold;
  color: #7a2c5c;
  cursor: pointer;
  padding: 10px;
  transition: color 0.3s;
}
.bottom-nav button:hover {
  color: #d81159;
}


    .back-button {
      margin: 10px 0;
      padding: 8px 16px;
      background: #f3e5f5;
      border: none;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    @keyframes fade {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .recipe-content {
  max-height: 0;
  opacity: 0;
  overflow: hidden;
  transition: max-height 0.5s ease, opacity 0.5s ease;
}

.recipe-content.open {
  max-height: none;
  opacity: 1;
}



    .detail-button, .main-button, .recipe-toggle, .favorite-button {
      padding: 10px 18px;
      font-size: 14px;
      font-weight: 600;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }

    .detail-button {
      background: linear-gradient(to right, #e0c3fc, #8ec5fc);
      color: #4b2c5e;
    }

    .main-button.generate {
      background: linear-gradient(to right, #d0caff, #e4b3ff);
      color: #42246b;
    }

    .main-button.clear {
      background: linear-gradient(to right, #ffcfd2, #fcb1b1);
      color: #742727;
    }

    .recipe-toggle {
      background: linear-gradient(to right, #ffdde1, #ee9ca7);
      color: #5d2c3e;
    }

    .favorite-button {
      background: linear-gradient(to right, #ffe0f0, #fbc2eb);
      color: #5c3e59;
    }

    .recipe-toggle:hover,
    .detail-button:hover,
    .main-button:hover,
    .favorite-button:hover {
      opacity: 0.9;
    }

    .swipe-hint {
      text-align: center;
      font-size: 14px;
      color: #a09e9e;
      animation: pulse 1.5s infinite;
      margin-bottom: 10px;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.4; }
      100% { opacity: 1; }
    }

    strong {
      background-color: #fff2aa;
      padding: 0 4px;
      border-radius: 4px;
    }

    .weekly-item {
      background: #fff9f9;
      border-radius: 14px;
      padding: 12px;
      margin-bottom: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
    }

    select {
      padding: 8px 12px;
      border-radius: 12px;
      border: 1px solid #ddd;
      font-size: 14px;
      background: #fffefe;
      outline: none;
    }
    .bottom-nav button.active {
  color: #d81159;
  border-bottom: 2px solid #d81159;
}
    .accordion-content {
  max-height: 0;
  transform: translateY(-10px);
  opacity: 0;
  overflow: hidden;
  transition: all 0.4s ease;
}

.accordion-open .accordion-content {
  max-height: none; /* üî• –ø—Ä–∏–±—Ä–∞–ª–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è */
  transform: translateY(0);
  opacity: 1;
}


    .slider-container {
  overflow-x: auto;
  white-space: nowrap;
  margin-top: 10px;
  padding-bottom: 5px;
}
.slider-container img {
  display: inline-block;
  height: 160px;
  margin-right: 10px;
  border-radius: 10px;
  object-fit: cover;
}
#match-threshold {
  padding: 12px 20px;         /* –ó–±—ñ–ª—å—à—É—î–º–æ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ –≤—ñ–¥—Å—Ç—É–ø–∏ */
  font-size: 18px;            /* –ó–±—ñ–ª—å—à—É—î–º–æ —Ä–æ–∑–º—ñ—Ä —à—Ä–∏—Ñ—Ç—É */
  border-radius: 16px;        /* –ö—Ä–∞—ó –æ–∫—Ä—É–≥–ª–µ–Ω—ñ */
  width: 120px;               /* –®–∏—Ä–∏–Ω–∞ —Å–µ–ª–µ–∫—Ç—É */
  cursor: pointer;            /* –ö—É—Ä—Å–æ—Ä –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ */
  background-color: #fff;     /* –ë—ñ–ª–∏–π —Ñ–æ–Ω */
  border: 1px solid #ccc;     /* –°–≤—ñ—Ç–ª–æ-—Å—ñ—Ä–∞ –æ–±–≤–æ–¥–∫–∞ */
  appearance: none;           /* –ü—Ä–∏–±–∏—Ä–∞—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Å—Ç–∏–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –∫—Ä–∞—â–æ—ó –∫–∞—Å—Ç–æ–º—ñ–∑–∞—Ü—ñ—ó) */
  -webkit-appearance: none;   /* –î–ª—è Safari */
  -moz-appearance: none;      /* –î–ª—è Firefox */
  position: relative;
  z-index: 1;
  background-image: url("data:image/svg+xml,%3Csvg fill='none' stroke='%237a2c5c' stroke-width='2' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 15px center;
  background-size: 16px 16px;
}

  </style>

</head>
<body>

  <div class="app">
    <h1>üçΩ –©–æ –ø—Ä–∏–≥–æ—Ç—É–≤–∞—Ç–∏?</h1>
    <div class="scroll-menu section active" id="section-categories"></div>

<!-- ‚úÖ –ü—ñ–¥–∫–∞–∑–∫–∞ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ .app -->

<div class="swipe-hint">‚¨Ö –ì–æ—Ä—Ç–∞–π –º–µ–Ω—é ‚û°</div>
    


<p style="
  text-align: center;
  font-size: 17px;
  font-family: 'Nunito', sans-serif;
  color: #5c3e59;
  font-weight: 600;
  background: linear-gradient(to right, #e8defc, #ffe0f0);
  padding: 12px;
  border-radius: 20px;
  margin-bottom: 15px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.05);
">
  üç∞ –©–æ–¥–Ω—è ‚Äî –Ω–æ–≤–∞ —Å–º–∞—á–Ω–∞ —ñ–¥–µ—è üåü –ì–æ—Ä—Ç–∞–π –≤–Ω–∏–∑, —â–æ–± –∑–Ω–∞–π—Ç–∏ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è –¥–ª—è –æ–±—ñ–¥—É —á–∏ –≤–µ—á–µ—Ä—ñ!
</p>

    
<div id="daily-recipe" class="section active"></div>
<button class="back-button" style="display:none;" onclick="goHome()">‚¨Ö –ù–∞ –≥–æ–ª–æ–≤–Ω—É</button>
<div id="section-recipes" class="section"></div>

<div class="section" id="section-menu">
  <h2>üìã –ú–æ—î –º–µ–Ω—é</h2>
  <p>–¢—É—Ç –±—É–¥—É—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —Ä–µ—Ü–µ–ø—Ç–∏.</p>
</div>
<div class="section" id="section-fridge">
  <h2>‚ùÑÔ∏è –©–æ —î –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫—É?</h2>
  <div style="margin-top:10px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
  <input id="fridge-input" 
         placeholder="–©–æ —î –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫—É..." 
         style="padding:14px 16px; font-size:16px; border-radius:16px; width:85%; max-width:400px;">
  <button onclick="searchFridge()" 
          style="padding:14px 20px; font-size:16px; border-radius:16px; background:linear-gradient(to right,#fbc2eb,#a6c1ee); color:#4b2c5e; font-weight:bold; border:none;">üîç –ó–Ω–∞–π—Ç–∏ —Ä–µ—Ü–µ–ø—Ç</button>
</div>

<div style="margin-top:10px; display: flex; align-items: center; gap: 10px;">
  <span style="font-size: 14px;">–ú—ñ–Ω—ñ–º—É–º –∑–±—ñ–≥—ñ–≤:</span>
  <button id="threshold-btn" onclick="cycleThreshold()" style="
  padding: 12px 20px;
  font-size: 18px;
  border-radius: 16px;
  width: 120px;
  cursor: pointer;
  background-color: #fff;
  border: 1px solid #ccc;
  font-weight: bold;
  background-image: none;
">2</button>

</div>


  <div id="fridge-results" style="margin-top:15px;"></div>
</div>

<!-- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–µ–Ω—é -->

<div class="section" id="section-planner">
  <h2>üìÖ –ú—ñ–π —Ç–∏–∂–Ω–µ–≤–∏–π –ø–ª–∞–Ω</h2>
  <p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ, —â–æ–± –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –º–µ–Ω—é –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å üëá</p>
 <button class="main-button generate" onclick="generateWeeklyMenu()">üîÑ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –º–µ–Ω—é</button>
<button class="main-button clear" onclick="clearWeeklyMenu()">üóë –û—á–∏—Å—Ç–∏—Ç–∏ –º–µ–Ω—é</button>
  <ul id="weekly-menu-list" style="padding-left:20px; margin-top:10px;"></ul>
</div>

<!-- ‚úÖ –æ–∫—Ä–µ–º–∞ —Å–µ–∫—Ü—ñ—è -->

<div class="section" id="section-buy">
  <h2>üõí –©–æ –∫—É–ø–∏—Ç–∏</h2>
  <div style="margin-top:10px;">
    <input class="custom-list-input" placeholder="–î–æ–¥–∞—Ç–∏ –¥–æ —Å–ø–∏—Å–∫—É..." style="padding:14px 16px; font-size:16px; border-radius:14px; width:85%; max-width:400px;">
    <button onclick="addToCustomList()" style="padding:8px;">‚ûï</button>
  </div>
  <ul id="custom-list-buy" style="padding-left: 20px;"></ul>
</div>

<div class="section" id="section-profile">
  <h2>üë§ –ú—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å</h2>
  <p id="days-left"></p>
  <div id="pro-check" style="margin-top: 20px;">
  <input type="text" id="donate-name" placeholder="–Ü–º º—è –∞–±–æ –æ—Å—Ç–∞–Ω–Ω—ñ 4 —Ü–∏—Ñ—Ä–∏ –∫–∞—Ä—Ç–∫–∏" style="padding: 8px; width: 80%;">
  <button onclick="submitPaymentCheck()" style="padding: 8px;">‚úÖ –Ø –æ–ø–ª–∞—Ç–∏–≤</button>
    <p id="pro-status" style="margin-top: 10px; font-weight: bold;"></p>
</div>
<div id="pro-confirmation" style="margin-top: 10px;"></div>

  <!-- üîΩ –û—Å—å —Ü–µ –¥–æ–¥–∞—î–º–æ -->

 <!-- üîΩ –í–∞—Ä—Ç—ñ—Å—Ç—å PRO + –∫–Ω–æ–ø–∫–∞ -->

<p style="margin-top: 10px; font-size: 15px; color: #5c3e59; background: #fff0f5; padding: 10px; border-radius: 12px;">
  üåü <strong>PRO –¥–æ—Å—Ç—É–ø</strong> –∫–æ—à—Ç—É—î <strong>50 –≥—Ä–Ω</strong><br>
  –û–ø–ª–∞—Ç–∏ —Å—É–º—É –Ω–∏–∂—á–µ —á–µ—Ä–µ–∑ Monobank, –∞ –ø–æ—Ç—ñ–º –Ω–∞—Ç–∏—Å–Ω–∏ ‚Äú–Ø –æ–ø–ª–∞—Ç–∏–≤‚Äù –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó.
</p>
<div id="pro-button-container"></div>

  <!-- ‚ÑπÔ∏è –ö–Ω–æ–ø–∫–∞ —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ PRO -->

<div style="position: relative; margin-bottom: 10px;">
  <button onclick="toggleProInfo()" style="
    position: absolute;
    top: 0;
    right: 0;
    background: #fbeaff;
    border: none;
    border-radius: 50%;
    width: 34px;
    height: 34px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  ">‚ÑπÔ∏è</button>
</div>

<div id="pro-info" style="
  display: none;
  background: #fff3fb;
  border: 1px solid #e0b3e0;
  padding: 15px;
  margin-top: 40px;
  border-radius: 12px;
  font-size: 14px;
">
  <h3 style="margin-top: 0;">ü•á –ß–æ–º—É –≤–∞—Ä—Ç–æ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ PRO?</h3>
  <ul style="padding-left: 20px;">
    <li>üîì –ù–µ–æ–±–º–µ–∂–µ–Ω–∏–π –ê—Å–∏—Å—Ç–µ–Ω—Ç</li>
    <li>üíõ –î–æ 100 —É–ª—é–±–ª–µ–Ω–∏—Ö —Ä–µ—Ü–µ–ø—Ç—ñ–≤</li>
    <li>üìÖ –ü–æ–≤–Ω–µ —Ç–∏–∂–Ω–µ–≤–µ –º–µ–Ω—é</li>
    <li>üõí –ï–∫—Å–ø–æ—Ä—Ç –ø–æ–∫—É–ø–æ–∫ —É PDF</li>
    <li>üì¶ –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —Ä–µ—Ü–µ–ø—Ç —Ç–∏–∂–Ω—è</li>
  </ul>
  <p style="margin-top:10px;">
  üü¢ –ê–∫—Ç–∏–≤—É–π <strong>PRO</strong>, —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏ –≤–µ—Å—å —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª!
</p>

</div>

<div class="accordion-block" id="weekly-accordion">
  <div class="accordion-title" onclick="toggleWeeklyInProfile()">
  üìÖ –ú–æ—î –º–µ–Ω—é
</div>
  <div class="accordion-content" id="weekly-wrapper">
    <ul id="weekly-list-profile" style="padding-left: 20px;"></ul>
  </div>
</div>

 <div class="accordion-block" id="fav-accordion">

  <div class="accordion-title" id="open-favorites">
    üíõ –£–ª—é–±–ª–µ–Ω—ñ —Ä–µ—Ü–µ–ø—Ç–∏ <span id="arrow-fav">üîΩ</span>
  </div>
  <div class="accordion-content" id="favorites-wrapper">
    <div id="favorites-container"></div>
  </div>
</div>

<div class="accordion-block" id="list-accordion">
  <div class="accordion-title" id="open-list">
    üõí –©–æ –∫—É–ø–∏—Ç–∏ <span id="arrow-list">üîΩ</span>
  </div>
  <div class="accordion-content" id="custom-wrapper">
    <div style="margin-top:10px;">
      <input class="custom-list-input" placeholder="–î–æ–¥–∞—Ç–∏ –¥–æ —Å–ø–∏—Å–∫—É..." style="padding:8px; width:80%;">
      <button onclick="addToCustomList()" style="padding:8px;">‚ûï</button>
    </div>
     <ul id="custom-list" style="padding-left: 20px;"></ul>
  </div> <!-- ‚úÖ –æ—Ü–µ –º–∞—î –±—É—Ç–∏ —Ç—É—Ç -->
</div>
  </div>
    <div class="section" id="section-askbot">
 <h2>ü§ñ –ó–∞–ø–∏—Ç–∞–π —É –ë–æ—Ç–∞</h2>
<p style="font-size: 15px; color: #5c3e59; background: #fff0f5; padding: 10px; border-radius: 12px;">
  –¢—É—Ç —Ç–∏ –º–æ–∂–µ—à –≤–≤–µ—Å—Ç–∏ –±—É–¥—å-—è–∫–µ –ø–∏—Ç–∞–Ω–Ω—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
  <br><strong>‚Ä¢ –©–æ –ø—Ä–∏–≥–æ—Ç—É–≤–∞—Ç–∏ –∑ –∫—É—Ä–∫–æ—é?</strong><br>
  <strong>‚Ä¢ –ß–∏–º –∑–∞–º—ñ–Ω–∏—Ç–∏ —è–π—Ü—è?</strong><br>
  <strong>‚Ä¢ –°—Ç—Ä–∞–≤–∞ –±–µ–∑ –º–æ–ª–æ–∫–∞</strong><br>
  <br>–ê—Å–∏—Å—Ç–µ–Ω—Ç –∑–Ω–∞–π–¥–µ —Ä–µ—Ü–µ–ø—Ç–∏, —è–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å —Ç–≤–æ—î–º—É –∑–∞–ø–∏—Ç—É ‚ú®
</p>

  <div style="margin-top:10px;">
    <input id="bot-query" placeholder="–Ω–∞–ø—Ä. —â–æ—Å—å –∑ –∫—É—Ä–∫–æ—é..." style="padding:14px 12px; width:85%; font-size:16px; border-radius:12px;">

    <button onclick="askBot()" style="padding:14px 20px; font-size:16px; border-radius:12px; background:linear-gradient(to right, #fbc2eb, #a6c1ee); color:#4b2c5e; font-weight:bold; border:none;">üîç –ó–Ω–∞–π—Ç–∏</button>

  </div>
  <div id="bot-response" style="margin-top:15px;"></div>
</div>
<div class="section" id="section-search">
  <h2>üîç –†–æ–∑—É–º–Ω–∏–π –ø–æ—à—É–∫ —Ä–µ—Ü–µ–ø—Ç—ñ–≤</h2>
  <div style="margin-top:10px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
    <input id="smart-search-input" 
           placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –∫–∞—Ä—Ç–æ–ø–ª—è –∑ –≥—Ä–∏–±–∞–º–∏..." 
           style="padding:14px 16px; font-size:16px; border-radius:16px; width:85%; max-width:400px;">
    <button onclick="runSmartSearch()" 
            style="padding:14px 20px; font-size:16px; border-radius:16px; background:linear-gradient(to right,#fbc2eb,#a6c1ee); color:#4b2c5e; font-weight:bold; border:none;">üîé –ó–Ω–∞–π—Ç–∏</button>
  </div>
  <div id="smart-search-results" style="margin-top:15px;"></div>
</div>


  <!-- –ù–∏–∂–Ω—î –º–µ–Ω—é -->

<div class="bottom-nav-wrapper">
  <div class="bottom-nav" id="bottomNav">
    <button onclick="showSection('section-profile')">üë§ –ü—Ä–æ—Ñ—ñ–ª—å</button>
    <button onclick="showSection('section-buy')">üõí –©–æ –∫—É–ø–∏—Ç–∏</button>
    <button onclick="showSection('section-askbot')">ü§ñ –ê—Å–∏—Å—Ç–µ–Ω—Ç</button>
    <button onclick="showSection('section-search')">üîç –ü–æ—à—É–∫</button>
    <button onclick="showSection('section-planner')">üìÖ –ú–µ–Ω—é –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å</button>
    <button onclick="showSection('section-fridge')">‚ùÑÔ∏è –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫</button>
  </div>
</div>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<button id="scrollTopBtn" onclick="scrollToTop()">‚¨ÜÔ∏è</button>


<script>
  
const categories = [
  "üë∂ –î–ª—è –¥—ñ—Ç–µ–π", "ü•ó –í–µ–≥–µ—Ç–∞—Ä—ñ–∞–Ω—Å—å–∫–µ", "üåæ –ë–µ–∑ –≥–ª—é—Ç–µ–Ω—É", "‚ö° –®–≤–∏–¥–∫–æ", "üç≤ –ü–µ—Ä—à—ñ —Å—Ç—Ä–∞–≤–∏",
  "ü•ò –î—Ä—É–≥—ñ —Å—Ç—Ä–∞–≤–∏", "ü•ó –°–∞–ª–∞—Ç–∏", "ü•í –ö–æ–Ω—Å–µ—Ä–≤–∞—Ü—ñ—è —Ç–∞ —Å–æ–ª—ñ–Ω–Ω—è", "ü•§ –ù–∞–ø–æ—ó", "üç∞ –î–µ—Å–µ—Ä—Ç–∏",
  "üçû –í–∏–ø—ñ—á–∫–∞", "ü•™ –ó–∞–∫—É—Å–∫–∏", "ü´ï –°–æ—É—Å–∏ —Ç–∞ –∑–∞–ø—Ä–∞–≤–∫–∏"
];
let threshold = 2; // üü¢ –¥–æ–¥–∞–Ω–æ!
async function fetchRecipes(category = null) {
  try {
    let url = 'https://recipe-backend-0gz1.onrender.com/recipes/short';
    if (category) url += `?category=${encodeURIComponent(category.toLowerCase())}`;
    const response = await fetch(url);
    const data = await response.json();
    console.log("üì¶ –í—ñ–¥–ø–æ–≤—ñ–¥—å –∑ –±–µ–∫–µ–Ω–¥—É:", data);
    return data;
  } catch (e) {
    console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ:", e);
    return [];
  }
}

function groupByRecipeNumber(data) {
  const grouped = {};
  data.forEach(item => {
    const num = item["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"];
    if (num) {
      grouped[num] = grouped[num] || [];
      grouped[num].push(item);
    }
  });
  return grouped;
}


async function loadCategories() {
  const container = document.getElementById('section-categories');
  container.innerHTML = '';
  categories.forEach(cat => {
    const btn = document.createElement('button');
    btn.innerText = cat;
    btn.onclick = async () => {
      const cleanCategory = cat.replace(/^[^\w–∞-—è–ê-–Ø“ê“ë–Ü—ñ–á—ó–Ñ—î]+/, '').trim();
      const raw = await fetchRecipes(cleanCategory.toLowerCase());
      const grouped = groupByRecipeNumber(raw);
      renderGroupedRecipes(grouped, cat);
    };
    container.appendChild(btn);
  });
}

async function loadDailyRecipe() {
  const recipes = await fetchRecipes();
localStorage.setItem('all_recipes', JSON.stringify(recipes));
const container = document.getElementById('daily-recipe');

const grouped = groupByRecipeNumber(recipes); // üü¢ –¥–æ–¥–∞–Ω–æ
const groupKeys = Object.keys(grouped);
if (groupKeys.length === 0) return;

const dayIndex = new Date().getDate() % groupKeys.length;
const recipe = grouped[groupKeys[dayIndex]];



  const info = recipe.find(r => r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") || recipe[0];
  const category = info["–∫–∞—Ç–µ–≥–æ—Ä—ñ—è"] || "–Ü–Ω—à–µ";
  const title = info["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"];

  // –§–æ—Ç–æ
  const imageBlock = recipe.find(r => r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ñ–æ—Ç–æ");
  const image = imageBlock ? imageBlock["–∫–æ–Ω—Ç–µ–Ω—Ç"] : "https://i.pinimg.com/736x/42/d0/47/42d0471e0094e28d71eaec86d78beec5.jpg";

  // –í–º—ñ—Å—Ç —Ä–µ—Ü–µ–ø—Ç–∞ (—Ç—ñ–ª–æ)
  let body = "";
  recipe.forEach(r => {
    if (r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") {
      body += `<p>${r["–∫–æ–Ω—Ç–µ–Ω—Ç"]}</p>`;
    } else if (r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ñ–æ—Ç–æ" && r !== imageBlock) {
      body += `<img src="${r["–∫–æ–Ω—Ç–µ–Ω—Ç"]}" style="max-width:100%; border-radius:10px; margin-top:10px;">`;
    } else if (r["—Ç–∏–ø –±–ª–æ–∫—É"] === "–≤—ñ–¥–µ–æ") {
      let video = r["–∫–æ–Ω—Ç–µ–Ω—Ç"];
      if (video.includes("drive.google.com")) {
        const match = video.match(/\/d\/([a-zA-Z0-9_-]+)/);
        if (match && match[1]) {
          video = `https://drive.google.com/file/d/${match[1]}/preview`;
          body += `<iframe src="${video}" style="width:100%; height:300px; border:none; border-radius:10px; margin-top:10px;" allowfullscreen></iframe>`;
        }
      } else {
        body += `<video controls style="width:100%; border-radius:10px; margin-top:10px;">
                   <source src="${video}" type="video/mp4">
                 </video>`;
      }
    }
  });

  container.innerHTML = `
  <div class="recipe-card" onclick="openDailyRecipeCategory('${category}', '${info["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"]}')"
       style="padding: 0; overflow: hidden; cursor: pointer;">
    <div class="daily-image-wrapper" style="position: relative;">
      <img src="${image}" alt="–†–µ—Ü–µ–ø—Ç –¥–Ω—è"
           style="width:100%; height:200px; object-fit:cover; border-radius: 16px 16px 0 0;">
      <div class="daily-label" style="...">–†–µ—Ü–µ–ø—Ç –¥–Ω—è üçì</div>
    </div>
    <div style="padding: 15px;">
      <h2 style="margin-top: 0;">${title}</h2>
    </div>
  </div>
`;

}

let currentRecipeIndex = 0;
let visibleRecipeCount = 20;
let currentUniqueGroups = [];

function renderGroupedRecipes(groups, category) {
  const container = document.getElementById('section-recipes');
  container.innerHTML = `<h2>üç¥ ${category}</h2>`;
  showSection('section-recipes');

  const seen = new Set();
  currentUniqueGroups = Object.values(groups).filter(group => {
    const recipeId = group[0]["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"];
    if (seen.has(recipeId)) return false;
    seen.add(recipeId);
    return true;
  });

  currentRecipeIndex = 0;
  renderNextBatch(container);
}

async function renderSingleRecipe(group, container, index) {

  const id = `recipe-details-${index}`;
  const info = group.find(r => r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") || group[0];
  const isFavorite = JSON.parse(localStorage.getItem('favorites') || '[]').includes(info["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"]);
  const card = document.createElement('div');
  card.className = 'recipe-card';
  card.setAttribute('data-recipe-id', info["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"]);

  let textBlock = "", firstImage = null, sliderImages = [], videoBlock = "";
  const seenBlocks = new Set();

  group.forEach(r => {
     for (const r of group) {
  const blockKey = `${r["—Ç–∏–ø –±–ª–æ–∫—É"]}|${r["–∫–æ–Ω—Ç–µ–Ω—Ç"]}`;
  if (seenBlocks.has(blockKey)) continue;
  seenBlocks.add(blockKey);

  if (r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") {
    textBlock += `<p>${r["–∫–æ–Ω—Ç–µ–Ω—Ç"]}</p>`;
  } else if (r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ñ–æ—Ç–æ") {
    if (!firstImage) {
      firstImage = `<img src="${r["–∫–æ–Ω—Ç–µ–Ω—Ç"]}" style="max-width:100%; border-radius:10px; margin-top:10px;">`;
    } else {
      sliderImages.push(r["–∫–æ–Ω—Ç–µ–Ω—Ç"]);
    }
  } else if (r["—Ç–∏–ø –±–ª–æ–∫—É"] === "–≤—ñ–¥–µ–æ" && !videoBlock) {
    let content = r["–∫–æ–Ω—Ç–µ–Ω—Ç"];

    if (content.startsWith("BAA")) {
      try {
        const res = await fetch(`/get-file-url?file_id=${content}`);
        const data = await res.json();
        if (data.url) {
          videoBlock = `<video controls style="width:100%; border-radius:10px; margin-top:10px;">
                          <source src="${data.url}" type="video/mp4">
                        </video>`;
        }
      } catch (err) {
        console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—ñ–¥–µ–æ —á–µ—Ä–µ–∑ file_id:", err);
      }
    } else if (content.includes("drive.google.com")) {
      const match = content.match(/\/d\/([a-zA-Z0-9_-]+)/);
      if (match && match[1]) {
        const embed = `https://drive.google.com/file/d/${match[1]}/preview`;
        videoBlock = `<iframe src="${embed}" style="width:100%; height:300px; border:none; border-radius:10px; margin-top:10px;" allowfullscreen></iframe>`;
      }
    } else {
      videoBlock = `<video controls style="width:100%; border-radius:10px; margin-top:10px;">
                      <source src="${content}" type="video/mp4">
                    </video>`;
    }
  }
}


  card.innerHTML = `
    <h3>${info["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"]}</h3>
    <p><strong>–ß–∞—Å:</strong> ${info["—á–∞—Å –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è"] || "?"} —Ö–≤</p>
    <p><strong>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</strong></p>
    <pre style="white-space: pre-wrap; font-family: inherit; margin-top: -10px;">${info["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"] || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ"}</pre>
    <div class="recipe-buttons">
      <button class="detail-button" onclick="toggleRecipe('${id}', this)">‚ûï –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</button>
      <button class="favorite-button" onclick="toggleFavorite('${info["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"]}', this)">üíõ –£ —Å–ø–∏—Å–∫—É</button>
    </div>
    <div id="${id}" class="recipe-content">
      ${firstImage || ''}
      ${textBlock}
      ${sliderImages.length > 0 ? `
        <div class="slider-container">
          <div class="swipe-hint">üì∏ –ì–æ—Ä—Ç–∞–π —Ñ–æ—Ç–æ ‚û°Ô∏è</div>
          ${sliderImages.map(src => `<img src="${src}" alt="–§–æ—Ç–æ" />`).join('')}
        </div>` : ''}
      ${videoBlock}
      <div style="text-align: center; margin-top: 20px;">
        <p style="font-size: 12px; color: #999; margin-top: 10px;">üë©‚Äçüç≥ –ê–≤—Ç–æ—Ä: ${info["–∞–≤—Ç–æ—Ä"] || "–Ω–µ–≤—ñ–¥–æ–º–æ"}</p>
        <button class="recipe-toggle" onclick="toggleRecipe('${id}', this)">üîº –ó–≥–æ—Ä–Ω—É—Ç–∏</button>
      </div>
    </div>
  `;

  container.appendChild(card);
}
  
async function renderNextBatch(container) {
  const batch = currentUniqueGroups.slice(currentRecipeIndex, currentRecipeIndex + visibleRecipeCount);
  await Promise.all(
  batch.map((group, index) =>
    renderSingleRecipe(group, container, currentRecipeIndex + index)
  )
);


  currentRecipeIndex += visibleRecipeCount;

  const existingButton = document.getElementById('load-more-btn');
  if (currentRecipeIndex < currentUniqueGroups.length) {
    if (!existingButton) {
      const btn = document.createElement('button');
      btn.id = "load-more-btn";
      btn.innerText = "‚ûï –©–µ —Ä–µ—Ü–µ–ø—Ç–∏";
      btn.className = "main-button generate";
      btn.onclick = () => renderNextBatch(container);
      container.appendChild(btn);
    }
  } else {
    existingButton?.remove();
  }
} // ‚Üê —Ü–µ –∫—ñ–Ω–µ—Ü—å —Ñ—É–Ω–∫—Ü—ñ—ó

// üîΩ –û–ö–†–ï–ú–ò–ô –í–ò–ö–õ–ò–ö (–Ω–µ –≤ —Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó)
showSection('section-recipes');


function toggleFavorite(recipeId, button) {
  let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
  const index = favorites.indexOf(recipeId);

  if (index === -1) {
  favorites.push(recipeId);
  button.innerText = '‚ù§Ô∏è –£–ª—é–±–ª–µ–Ω–µ';
  showToast("‚úÖ –î–æ–¥–∞–Ω–æ –¥–æ —É–ª—é–±–ª–µ–Ω–æ–≥–æ!");
} else {
  favorites.splice(index, 1);
  button.innerText = 'üíõ –£ —Å–ø–∏—Å–æ–∫';
  showToast("‚ùå –í–∏–¥–∞–ª–µ–Ω–æ –∑ —É–ª—é–±–ª–µ–Ω–æ–≥–æ");
}


  button.disabled = false;
  localStorage.setItem('favorites', JSON.stringify(favorites));

  if (document.getElementById('favorites-container')) {
    loadFavorites(); // –æ–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–æ—Ñ—ñ–ª—å –ø—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
  }
}

  function showToast(message = "‚úÖ –î–æ–¥–∞–Ω–æ –¥–æ —É–ª—é–±–ª–µ–Ω–æ–≥–æ!") {
  const toast = document.getElementById("toast");
  if (!toast) return;

  toast.innerText = message;
  toast.style.display = "block";

  setTimeout(() => {
    toast.style.display = "none";
  }, 2000);
}

  
function toggleRecipe(id, btn) {
  const el = document.getElementById(id);
  if (!el) return;

  if (el.classList.contains('open')) {
    el.classList.remove('open');
    if (btn) btn.innerText = '‚ûï –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ';
  } else {
    el.classList.add('open');
    if (btn) btn.innerText = 'üîº –ó–≥–æ—Ä–Ω—É—Ç–∏';
  }
}
  
async function openDailyRecipeCategory(category, focusId = null) {
  const cleanCategory = category.replace(/^[^\w–∞-—è–ê-–Ø“ê“ë–Ü—ñ–á—ó–Ñ—î]+/, '').trim();
  const raw = await fetchRecipes(cleanCategory.toLowerCase());
  const grouped = groupByRecipeNumber(raw);
  renderGroupedRecipes(grouped, cleanCategory);
  // üîΩ –î–æ–¥–∞—Ç–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫—É –¥–æ —Ä–µ—Ü–µ–ø—Ç–∞:
setTimeout(() => {
  if (focusId) {
    const target = document.querySelector(`[data-recipe-id='${focusId}']`);
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      target.classList.add('highlight'); // –º–æ–∂–Ω–∞ —Å—Ç–∏–ª—ñ–∑—É–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ CSS
    }
  }
}, 300);
}



function showSection(id) {
  // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –≤—Å—ñ —Å–µ–∫—Ü—ñ—ó
  document.querySelectorAll('.section').forEach(el => {
  el.classList.remove('active');
});
document.getElementById('section-categories').classList.remove('active'); // —è–≤–Ω–æ —Å—Ö–æ–≤–∞—Ç–∏
document.getElementById('daily-recipe').classList.remove('active');


  // –ê–∫—Ç–∏–≤—É—î–º–æ –ø–æ—Ç–æ—á–Ω—É
  
  document.getElementById(id).classList.add('active');

  // ‚úÖ –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É "‚¨Ö –ù–∞ –≥–æ–ª–æ–≤–Ω—É"
  document.querySelector('.back-button').style.display = 'block';

  // –Ø–∫—â–æ —Ü–µ "–ú–µ–Ω—é –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å" ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
  if (id === 'section-planner') {
    const saved = JSON.parse(localStorage.getItem('weekly_menu'));
    if (saved && Array.isArray(saved)) {
      renderWeeklyMenu(saved);
    }
  }

  // –Ø–∫—â–æ —Ü–µ –ø—Ä–æ—Ñ—ñ–ª—å –∞–±–æ —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤—Å–µ
  if (id === 'section-profile' || id === 'section-buy') {
    loadFavorites();
    loadCustomList();
    loadWeeklyInProfile();
  }
}


function clearWeeklyMenu() {
  localStorage.removeItem('weekly_menu');
  document.getElementById('weekly-menu-list').innerHTML = '<li>–ú–µ–Ω—é –æ—á–∏—â–µ–Ω–æ</li>';
}
  
function goHome() {
  // –ü—Ä–∏—Ö–æ–≤—É—î –≤—Å—ñ —Å–µ–∫—Ü—ñ—ó
  document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));

  // –ê–∫—Ç–∏–≤—É—î –≤–µ—Ä—Ö–Ω—î –º–µ–Ω—é –∫–∞—Ç–µ–≥–æ—Ä—ñ–π —ñ —Ä–µ—Ü–µ–ø—Ç –¥–Ω—è
  document.getElementById('section-categories').classList.add('active');
  document.getElementById('daily-recipe').classList.add('active');

  // –•–æ–≤–∞—î –∫–Ω–æ–ø–∫—É "‚¨Ö –ù–∞ –≥–æ–ª–æ–≤–Ω—É"
  document.querySelector('.back-button').style.display = 'none';

  // –ü–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î —Ä–µ—Ü–µ–ø—Ç –¥–Ω—è
  
  loadDailyRecipe();
}

  function showSubscribeModal() {
  document.getElementById('subscribe-modal').style.display = 'flex';
  document.getElementById('subscribe-btn').onclick = function() {
    window.open('https://t.me/receptukTop', '_blank'); // <-- –∑–∞–º—ñ–Ω–∏ –Ω–∞ —Å–≤—ñ–π –∫–∞–Ω–∞–ª
  };
}


document.addEventListener("DOMContentLoaded", () => {
  async function init() {
    await initAllRecipes(); // üü¢ –≤–∏–∫–ª–∏–∫ —Ç–≤–æ—î—ó –Ω–æ–≤–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó
    await loadCategories();
    await loadDailyRecipe();
    goHome();
  }

  autoScrollSliders(); // ‚úÖ –∑–∞–ø—É—Å–∫–∞—î–º–æ –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫—É
init();
    // üñ±Ô∏è Enter ‚Üí –ø–æ—à—É–∫ —É —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫—É
 document.getElementById('fridge-input')?.addEventListener('keydown', function (e) {
  if (e.key === 'Enter') {
    e.preventDefault();
    this.blur(); // ‚Üê —Ö–æ–≤–∞—î –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É
    searchFridge();
  }
});


  // üñ±Ô∏è Enter ‚Üí askBot
  document.getElementById('bot-query')?.addEventListener('keydown', function (e) {
  if (e.key === 'Enter') {
    e.preventDefault();
    this.blur(); // ‚Üê —Ö–æ–≤–∞—î –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É
    askBot();
  }
});


  // üñ±Ô∏è Enter ‚Üí smart search
  document.getElementById('smart-search-input')?.addEventListener('keydown', function (e) {
  if (e.key === 'Enter') {
    e.preventDefault();
    this.blur(); // ‚Üê —Ö–æ–≤–∞—î –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É
    runSmartSearch();
  }
});

    // üì± –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–æ —ñ–Ω–ø—É—Ç–∞ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏
  document.querySelectorAll('input').forEach(input => {
    input.addEventListener('focus', () => {
      setTimeout(() => {
        input.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 300);
    });
  });

  const tg = window.Telegram?.WebApp;

if (tg && tg.initDataUnsafe?.user?.id) {
  const userId = tg.initDataUnsafe.user.id;

  fetch(`https://recipe-backend-0gz1.onrender.com/check-subscription?user_id=${userId}`)
    .then(res => res.json())
    .then(data => {
      console.log("üîç –°—Ç–∞—Ç—É—Å –ø—ñ–¥–ø–∏—Å–∫–∏:", data);

      if (!data.is_subscribed) {
  showSubscribeModal();
} else {
  console.log('‚úÖ –ü—ñ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞');
}

    })
    .catch(err => {
      console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ–¥–ø–∏—Å–∫–∏:", err);
    });
}


// ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ PRO-–¥–æ—Å—Ç—É–ø—É

if (!tg || !tg.initDataUnsafe?.user?.id) {
  document.getElementById('pro-status').innerText = '‚ùå Telegram WebApp –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π';
} else {
  const userId = tg.initDataUnsafe.user.id;

  // üü¢ –õ–æ–∫–∞–ª—å–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ (—ñ–∑ localStorage)
  if (localStorage.getItem('is_pro') === 'true') {
    document.body.classList.add("pro-user");
    const expires = localStorage.getItem('pro_expires') || '';
    document.getElementById("pro-status").innerText = "üåü –£ —Ç–µ–±–µ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∏–π PRO –¥–æ—Å—Ç—É–ø!";
    document.getElementById("days-left").innerHTML = "üëë –î—ñ–π—Å–Ω–∏–π –¥–æ: " + expires;
    const header = document.querySelector("h1");
    if (header) {
      header.innerText = "üëë –©–æ –ø—Ä–∏–≥–æ—Ç—É–≤–∞—Ç–∏?";
    }
    document.getElementById("pro-confirmation").innerHTML = "üéâ –î–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ! –î—è–∫—É—î–º–æ üíõ";
  }

  // üü¢ –û–Ω–ª–∞–π–Ω-–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ ‚Äî –¢–£–¢ –¢–ï–ü–ï–† fetch
  fetch(`https://recipe-backend-0gz1.onrender.com/is-pro?user_id=${userId}`)
    .then(res => res.json())
    .then(data => {
      if (data.is_pro) {
        document.body.classList.add("pro-user");
        localStorage.setItem('is_pro', 'true');
        localStorage.setItem('pro_expires', data.expires || '');

        document.getElementById("pro-status").innerText = "üåü –£ —Ç–µ–±–µ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∏–π PRO –¥–æ—Å—Ç—É–ø!";
        document.getElementById("days-left").innerHTML = "üëë –î—ñ–π—Å–Ω–∏–π –¥–æ: " + (data.expires || "–Ω–µ–≤—ñ–¥–æ–º–æ");
        const header = document.querySelector("h1");
        if (header) {
          header.innerText = "üëë –©–æ –ø—Ä–∏–≥–æ—Ç—É–≤–∞—Ç–∏?";
        }
        document.getElementById("pro-confirmation").innerHTML = "üéâ –î–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ! –î—è–∫—É—î–º–æ üíõ";
      } else {
        document.getElementById("pro-status").innerText = "üîí PRO –¥–æ—Å—Ç—É–ø —â–µ –Ω–µ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ.";
        document.getElementById("days-left").innerHTML = "";
      }
    });
}




    // ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏ –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫—É –ø–æ–∑–∞ –ø–æ–ª–µ–º ‚Äî —Ç—ñ–ª—å–∫–∏ –≤ –æ–±—Ä–∞–Ω–∏—Ö —Å–µ–∫—Ü—ñ—è—Ö
  ['section-askbot', 'section-buy', 'section-fridge', 'section-search'].forEach(sectionId => {
  const section = document.getElementById(sectionId);
  if (!section) return;
  section.addEventListener('click', (e) => {
    const isInput = e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA';
    if (!isInput) {
      document.activeElement.blur();
    }
  });
});


  const proBtn = document.createElement('button');
proBtn.innerText = "üåü –û—Ç—Ä–∏–º–∞—Ç–∏ PRO";
proBtn.className = "pro-button";
proBtn.onclick = () => {
  window.open("https://send.monobank.ua/jar/6agGfuJmcv", "_blank");
};
document.getElementById("pro-button-container")?.appendChild(proBtn);


  document.getElementById('open-favorites')?.addEventListener('click', () => {
  const block = document.getElementById('fav-accordion');
  const arrow = document.getElementById('arrow-fav');
  const isOpen = block.classList.contains('accordion-open');
  block.classList.toggle('accordion-open');
  arrow.innerText = isOpen ? 'üîΩ' : 'üîº';

  // üü¢ –ó–∞–≤–∂–¥–∏ –æ–Ω–æ–≤–ª—é—î–º–æ —É–ª—é–±–ª–µ–Ω—ñ —Ä–µ—Ü–µ–ø—Ç–∏
  loadFavorites();

  if (!isOpen) {
    setTimeout(() => {
      block.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 300);
  }
});


  document.getElementById('open-list')?.addEventListener('click', () => {
  showSection('section-profile');
  const block = document.getElementById('list-accordion');
  const wrapper = document.getElementById('custom-wrapper');
  const arrow = document.getElementById('arrow-list');
  const isOpen = block.classList.contains('accordion-open');
  block.classList.toggle('accordion-open');
  arrow.innerText = isOpen ? 'üîΩ' : 'üîº';
  if (!isOpen) {
    loadCustomList();
    setTimeout(() => {
      block.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 300);
  }
});


});

  // üîΩ –î–∏–Ω–∞–º—ñ—á–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–û—Ç—Ä–∏–º–∞—Ç–∏ PRO"

  
// ‚úÖ –ê –æ—Å—å —Ñ—É–Ω–∫—Ü—ñ—è –ó–û–í–ù–Ü:
function toggleListSection() {
  showSection('section-profile');
  const wrapper = document.getElementById('custom-wrapper');
  const arrow = document.getElementById('arrow-list');
  const isVisible = wrapper.style.display === 'block';
  wrapper.style.display = isVisible ? 'none' : 'block';
  arrow.innerText = isVisible ? 'üîΩ' : 'üîº';
  if (!isVisible) loadCustomList();
}




async function loadFavorites() {
  const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
  const container = document.getElementById('favorites-container');
  if (!favorites.length) {
    container.innerHTML = '<p>–ù–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö —Ä–µ—Ü–µ–ø—Ç—ñ–≤</p>';
    return;
  }

  const allRecipes = await fetchRecipes();
  const grouped = groupByRecipeNumber(allRecipes);
  const filteredGroups = grouped.filter(group => {
    const info = group.find(r => r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") || group[0];
    return favorites.includes(String(info["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"]));
  });

  container.innerHTML = '';
  filteredGroups.forEach((group, index) => {
    const id = `favorite-details-${index}`; // —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID

    const info = group.find(r => r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") || group[0];
    const card = document.createElement('div');
    card.className = 'recipe-card';

    card.innerHTML = `
      <h3>${info["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"]}</h3>
      <p><strong>–ß–∞—Å:</strong> ${info["—á–∞—Å –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è"] || "?"} —Ö–≤</p>
      <p><strong>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</strong></p>
<pre style="white-space: pre-wrap; font-family: inherit; margin-top: -10px;">${info["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"] || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ"}</pre>

      <div class="recipe-buttons">
        <button class="detail-button" 
        onclick="toggleRecipe('${id}', this)">‚ûï –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</button>
        <button class="favorite-button" onclick="toggleFavorite('${info["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"]}', this)">üíõ –£ —Å–ø–∏—Å–∫—É</button>
      </div>
      <div id="${id}" class="recipe-content"></div>
    `;

    container.appendChild(card);

    const block = document.getElementById(id);
let contentAdded = false;

group.forEach(r => {

  if (r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") {
    block.innerHTML += `<p>${r["–∫–æ–Ω—Ç–µ–Ω—Ç"]}</p>`;
    contentAdded = true;
  } else if (r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ñ–æ—Ç–æ") {
    block.innerHTML += `<img src="${r["–∫–æ–Ω—Ç–µ–Ω—Ç"]}" style="max-width:100%; border-radius:10px; margin-top:10px;">`;
    contentAdded = true;
  } else if (r["—Ç–∏–ø –±–ª–æ–∫—É"] === "–≤—ñ–¥–µ–æ") {
  let videoLink = r["–∫–æ–Ω—Ç–µ–Ω—Ç"];
  if (videoLink.includes('drive.google.com')) {
    const match = videoLink.match(/\/d\/([a-zA-Z0-9_-]+)/);
    if (match && match[1]) {
      videoLink = `https://drive.google.com/file/d/${match[1]}/preview`;
    }
    block.innerHTML += `
      <iframe 
        src="${videoLink}" 
        style="width:100%; height:300px; border:none; border-radius:10px; margin-top:10px;" 
        allowfullscreen>
      </iframe>
    `;
  } else {
    block.innerHTML += `
      <video controls style="width:100%; border-radius:10px; margin-top:10px;">
        <source src="${videoLink}" type="video/mp4">
        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ–¥–µ–æ.
      </video>
    `;
  }
  contentAdded = true;
}

});

if (contentAdded) {
  block.innerHTML += `
    <div style="text-align: center; margin-top: 20px;">
      <p style="font-size: 12px; color: #999; margin-top: 10px;">üë©‚Äçüç≥ –ê–≤—Ç–æ—Ä: ${info["–∞–≤—Ç–æ—Ä"] || "–Ω–µ–≤—ñ–¥–æ–º–æ"}</p>
      <button class="recipe-toggle" onclick="toggleRecipe('${id}', this)">üîº –ó–≥–æ—Ä–Ω—É—Ç–∏</button>
    </div>
  `;
} else {
  block.innerHTML = `<p>ü§∑ –£ —Ü—å–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç—É –Ω–µ–º–∞—î –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–ø–∏—Å—É.</p>`;
}




  });
}

function loadCustomList() {
  const items = JSON.parse(localStorage.getItem('custom_list')) || [];

  // üîÅ 1. –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ —É –ø—Ä–æ—Ñ—ñ–ª—ñ
  const containerProfile = document.getElementById('custom-list');
  if (containerProfile) {
    containerProfile.innerHTML = '';
    if (!items.length) {
      containerProfile.innerHTML = '<li>–ü–æ—Ä–æ–∂–Ω—å–æ</li>';
    } else {
      items.forEach((item, index) => {
        const li = document.createElement('li');
            li.className = 'weekly-item';;
        li.innerHTML = `${item} <button onclick="removeFromCustomList(${index})" style="margin-left:10px; cursor:pointer;">üóë</button>`;
        containerProfile.appendChild(li);
      });
    }
  }

  // üîÅ 2. –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ —É —Å–µ–∫—Ü—ñ—ó "–©–æ –∫—É–ø–∏—Ç–∏"
  const containerBuy = document.getElementById('custom-list-buy');
  if (containerBuy) {
    containerBuy.innerHTML = '';
    if (!items.length) {
      containerBuy.innerHTML = '<li>–ü–æ—Ä–æ–∂–Ω—å–æ</li>';
    } else {
      items.forEach((item, index) => {
        const li = document.createElement('li');
        li.innerHTML = `‚Ä¢ ${item} <button onclick="removeFromCustomList(${index})" style="margin-left:10px; cursor:pointer;">üóë</button>`;
        containerBuy.appendChild(li);
      });
    }
  }
}

function addToCustomList() {
  const inputs = document.querySelectorAll('.custom-list-input');
  const input = Array.from(inputs).find(el => el.offsetParent !== null);
  if (!input) return;

  const value = input.value.trim();
  if (!value) return;

  const items = JSON.parse(localStorage.getItem('custom_list')) || [];
  items.push(value);
  localStorage.setItem('custom_list', JSON.stringify(items));
  input.value = '';
  loadCustomList();

  // ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ñ–æ–∫—É—Å—É–≤–∞–Ω–Ω—è –Ω–∞ –ø–æ–ª–µ
  setTimeout(() => input.focus(), 0);
}



function removeFromCustomList(index) {
  const items = JSON.parse(localStorage.getItem('custom_list')) || [];
  items.splice(index, 1); // –≤–∏–¥–∞–ª—è—î–º–æ –æ–±—Ä–∞–Ω–∏–π
  localStorage.setItem('custom_list', JSON.stringify(items));
  loadCustomList(); // –æ–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
} // ‚Üê ‚úÖ –æ—Ü–µ –±—É–ª–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
function toggleWeeklyInProfile() {
  showSection('section-planner'); // –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—É—î–º–æ –æ—Å–Ω–æ–≤–Ω—É —Å–µ–∫—Ü—ñ—é –º–µ–Ω—é
}



function loadWeeklyInProfile() {
  const list = document.getElementById('weekly-list-profile');
  const saved = JSON.parse(localStorage.getItem("weekly_menu")) || [];

  list.innerHTML = saved.length
    ? saved.map(item => `<li><strong>${item.day}:</strong> ${item.category}</li>`).join('')
    : '<li>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ</li>';
}


setTimeout(() => {
  const hint = document.querySelector('.swipe-hint');
  if (hint) {
    hint.style.opacity = '0';
    hint.style.pointerEvents = 'none';
    setTimeout(() => hint.remove(), 400);
  }
}, 30000); // 10 —Å–µ–∫—É–Ω–¥

// ‚úÖ –í–ò–ù–ï–°–ï–ù–ê –ó–û–í–ù–Ü –§–£–ù–ö–¶–Ü–Ø:
async function loadRecipesForDay(day, category, container) {
  const data = await fetchRecipes(category.toLowerCase());
  const grouped = groupByRecipeNumber(data);
  const recipe = grouped[0];
  if (!recipe) {
    container.innerHTML = "<p>–ù–µ–º–∞—î —Ä–µ—Ü–µ–ø—Ç—ñ–≤ üòû</p>";
    return;
  }

  const info = recipe.find(r => r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") || recipe[0];
  container.innerHTML = `
    <div class="recipe-card">
      <h3>${info["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"]}</h3>
      <p><strong>–ß–∞—Å:</strong> ${info["—á–∞—Å –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è"] || "?"} —Ö–≤</p>
      <p><strong>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</strong> ${info["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"] || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ"}</p>
    </div>
  `;

}

function generateWeeklyMenu() {
  const categories = [
    "–ü–µ—Ä—à—ñ —Å—Ç—Ä–∞–≤–∏", "–î—Ä—É–≥—ñ —Å—Ç—Ä–∞–≤–∏", "–°–∞–ª–∞—Ç–∏", "–î–µ—Å–µ—Ä—Ç–∏", "–í–∏–ø—ñ—á–∫–∞", "–ó–∞–∫—É—Å–∫–∏", "–ù–∞–ø–æ—ó"
  ];
  const days = ["–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°–±", "–ù–¥"];
  const list = [];

  days.forEach(day => {
    const randomCategory = categories[Math.floor(Math.random() * categories.length)];
    list.push({ day, category: randomCategory });
  });

  // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ localStorage
  localStorage.setItem("weekly_menu", JSON.stringify(list));
  renderWeeklyMenu(list);
}
function renderWeeklyMenu(menu) {
  const container = document.getElementById('weekly-menu-list');
  container.innerHTML = '';

  const allCategories = [
    "–ü–µ—Ä—à—ñ —Å—Ç—Ä–∞–≤–∏", "–î—Ä—É–≥—ñ —Å—Ç—Ä–∞–≤–∏", "–°–∞–ª–∞—Ç–∏", "–î–µ—Å–µ—Ä—Ç–∏",
    "–í–∏–ø—ñ—á–∫–∞", "–ó–∞–∫—É—Å–∫–∏", "–ù–∞–ø–æ—ó"
  ];

  menu.forEach((item, index) => {
   const li = document.createElement('li');
    li.className = 'weekly-item';
    const select = document.createElement('select');
    const recipeContainer = document.createElement('div'); // üü¢ –ø–µ—Ä–µ–Ω–µ—Å–ª–∏ —Å—é–¥–∏!

    recipeContainer.className = 'recipe-card hidden';
    recipeContainer.id = `${item.day}-${index}`;

    allCategories.forEach(cat => {
      const option = document.createElement('option');
      option.value = cat;
      option.textContent = cat;
      if (cat === item.category) option.selected = true;
      select.appendChild(option);
    });

    select.onchange = () => {
      updateMenuCategory(index, select.value);
      loadRecipesForDay(item.day, select.value, recipeContainer); // ‚úÖ —Ç–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—î
    };

    const dayIcons = {
  '–ü–Ω': 'üåû', '–í—Ç': 'üåø', '–°—Ä': 'ü•ï', '–ß—Ç': 'üçÖ',
  '–ü—Ç': 'üçù', '–°–±': 'üç∞', '–ù–¥': '‚òï'
};
li.innerHTML = `<strong>${dayIcons[item.day] || ''} ${item.day}:</strong> `;

    li.appendChild(select);

    const toggleBtn = document.createElement('button');
    toggleBtn.className = 'recipe-toggle';
    toggleBtn.innerHTML = '<span class="rotate-toggle">üîΩ</span> –ó–≥–æ—Ä–Ω—É—Ç–∏';
    toggleBtn.onclick = () => toggleRecipe(`${item.day}-${index}`, toggleBtn);

    li.appendChild(toggleBtn);
    li.appendChild(recipeContainer);
    container.appendChild(li);

    loadRecipesForDay(item.day, item.category, recipeContainer);
  });
}

  

  async function searchFridge() {
  const input = document.getElementById('fridge-input').value.toLowerCase();
  const fridgeItems = input.split(/[\s,]+/).map(i => i.trim()).filter(Boolean);
  const normFridgeItems = fridgeItems.map(normalizeWord);
  const results = [];
  const all = await fetchRecipes(); // —Ç—è–≥–Ω–µ —Ç—ñ–ª—å–∫–∏ –∑–∞—Ä–∞–∑


  all.forEach(r => {
   const rawIngredients = (r["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"] || "").toLowerCase();
const ingredientWords = new Set(
  rawIngredients
    .split(/[,\n]+/)
    .flatMap(ing => normalizeWord(ing.trim()).split(/\s+/))
    .filter(Boolean)
);



    const matches = normFridgeItems.filter(i => ingredientWords.has(i)).length;
    const threshold = parseInt(document.getElementById('threshold-btn').innerText, 10);

    if (matches >= threshold) {
      // –ü—ñ–¥—Å–≤—ñ—á—É—î–º–æ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏
      let highlighted = r["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"];
      fridgeItems.forEach(word => {
        const normWord = normalizeWord(word);
        const regex = new RegExp(`(${normWord}\\w*)`, 'gi');
        highlighted = highlighted.replace(regex, '<strong>$1</strong>');
      });

      results.push({
        ...r,
        matches,
        hasFirst: ingredientWords.has(normFridgeItems[0]),
        highlighted
      });
    }
  });

  results.sort((a, b) => {
    if (b.hasFirst !== a.hasFirst) return b.hasFirst - a.hasFirst;
    return b.matches - a.matches;
  });

    // üîΩ –û–±–º–µ–∂—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
results.length = Math.min(results.length, 20);

  

  const container = document.getElementById('fridge-results');
  container.innerHTML = results.length
    ? results.map(r => {
        let title = r["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"];
        fridgeItems.forEach(word => {
          const normWord = normalizeWord(word);
          const regex = new RegExp(`(${normWord}\\w*)`, 'gi');
          title = title.replace(regex, '<strong>$1</strong>');
        });

        return `<div class="recipe-card">
  <h3>${title}</h3>
  <p>${r["highlighted"]}</p>
  <p><em>üîç –ó–±—ñ–≥—ñ–≤: <strong>${r.matches}</strong></em></p>
</div>`;

      }).join('')
    : '<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üòû</p>';
}

function updateMenuCategory(index, newValue) {
  const menu = JSON.parse(localStorage.getItem('weekly_menu')) || [];
  if (menu[index]) {
    menu[index].category = newValue.trim();
    localStorage.setItem('weekly_menu', JSON.stringify(menu));
  }
}
  function normalizeWord(word) {
  word = word.toLowerCase()
    .replace(/[ º‚Äô'‚Äô.,;!?]/g, '')
    .replace(/[—ñ—ó—î“ë]/g, ch => ({ —ñ: '–∏', —ó: '–∏', —î: '–µ', “ë: '–≥' }[ch] || ch));

  // –í–∏–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à—ñ –≤–∏–Ω—è—Ç–∫–∏
  const stems = {
    '–∫–∞—Ä—Ç–æ–ø–ª—è': '–∫–∞—Ä—Ç–æ–ø–ª', '–∫–∞—Ä—Ç–æ–ø–ª—ñ': '–∫–∞—Ä—Ç–æ–ø–ª', '–∫–∞—Ä—Ç–æ–ø–ª–µ—é': '–∫–∞—Ä—Ç–æ–ø–ª', '–∫–∞—Ä—Ç–æ–ø–ª—é': '–∫–∞—Ä—Ç–æ–ø–ª',
    '–º–æ—Ä–∫–≤–∞': '–º–æ—Ä–∫–≤', '–º–æ—Ä–∫–≤–æ—é': '–º–æ—Ä–∫–≤',
    '—Ü–∏–±—É–ª—è': '—Ü–∏–±—É–ª', '—Ü–∏–±—É–ª–µ—é': '—Ü–∏–±—É–ª',
    '–±—É—Ä—è–∫': '–±—É—Ä—è–∫', '–±—É—Ä—è–∫–∞': '–±—É—Ä—è–∫', '–±—É—Ä—è–∫–æ–º': '–±—É—Ä—è–∫',
    '–æ–≥—ñ—Ä–æ–∫': '–æ–≥—ñ—Ä–æ–∫', '–æ–≥—ñ—Ä–∫–∏': '–æ–≥—ñ—Ä–æ–∫', '–æ–≥—ñ—Ä–∫–∞–º–∏': '–æ–≥—ñ—Ä–æ–∫',
    '–ø–æ–º—ñ–¥–æ—Ä': '–ø–æ–º—ñ–¥–æ—Ä', '–ø–æ–º—ñ–¥–æ—Ä–∏': '–ø–æ–º—ñ–¥–æ—Ä',
    '—è–π—Ü–µ': '—è–π—Ü', '—è–π—Ü—è': '—è–π—Ü',
    '—Ä–∏—Å': '—Ä–∏—Å', '–≥—Ä–µ—á–∫–∞': '–≥—Ä–µ—á–∫',
    '–º–æ–ª–æ–∫–æ': '–º–æ–ª–æ–∫', '–º–æ–ª–æ–∫–∞': '–º–æ–ª–æ–∫',
    '–º–∞—Å–ª–æ': '–º–∞—Å–ª', '–º–∞—Å–ª–∞': '–º–∞—Å–ª'
  };
  if (stems[word]) return stems[word];

  // –ì–Ω—É—á–∫–µ –æ–±—Ä—ñ–∑–∞–Ω–Ω—è —Ç–∏–ø–æ–≤–∏—Ö –∑–∞–∫—ñ–Ω—á–µ–Ω—å
  const endings = ['–æ—é', '–µ—é', '—î—é', '–∞–º–∏', '—è–º–∏', '—ñ', '–∞', '—É', '—é', '–æ–º', '–µ–º', '–æ', '–µ', '—ñ–≤', '–µ–≤', '–∞—Ö', '—è—Ö'];
  for (const end of endings) {
    if (word.endsWith(end) && word.length - end.length > 2) {
      return word.slice(0, -end.length);
    }
  }

  return word;
}




const stopWords = ["–∑", "–Ω–∞", "—â–æ", "—è–∫", "—ñ", "—Ç–∞", "–∞–±–æ", "—É", "–≤", "–¥–æ", "–ø–æ", "—á–∏", "—ñ–∑", "—ñ–∑-–∑–∞"];

  async function initAllRecipes() {
  if (!localStorage.getItem('all_recipes')) {
    const res = await fetch('https://recipe-backend-0gz1.onrender.com/recipes');
    const data = await res.json();
    window._all_recipes = data;

  }
}

async function askBot() {
  const input = document.getElementById('bot-query');
  const query = input.value.trim();

  const container = document.getElementById('bot-response');
  if (!query) {
    container.innerHTML = '<p>–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥–∏ –∑–∞–ø–∏—Ç üôÉ</p>';
    return;
  }

  container.innerHTML = '<p>üîç –®—É–∫–∞—î–º–æ...</p>';

  try {
    const res = await fetch(`https://recipe-backend-0gz1.onrender.com/search?query=${encodeURIComponent(query)}`);
    const data = await res.json();

    if (!data.length) {
      container.innerHTML = '<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üòû</p>';
      return;
    }

    const html = data.map((group, index) => {
      const r = group.find(x => x["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") || group[0];
      const id = `search-result-${r["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"]}-${index}`;

      let firstImage = null;
      let sliderImages = [];
      let blocks = "";
      const seen = new Set();

      group.forEach(x => {
        const key = `${x["—Ç–∏–ø –±–ª–æ–∫—É"]}|${x["–∫–æ–Ω—Ç–µ–Ω—Ç"]}`;
        if (seen.has(key)) return;
        seen.add(key);

        if (x["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") {
          blocks += `<p>${x["–∫–æ–Ω—Ç–µ–Ω—Ç"]}</p>`;
        } else if (x["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ñ–æ—Ç–æ") {
          if (!firstImage) {
            firstImage = `<img src="${x["–∫–æ–Ω—Ç–µ–Ω—Ç"]}" style="max-width:100%; border-radius:10px; margin-top:10px;">`;
          } else {
            sliderImages.push(x["–∫–æ–Ω—Ç–µ–Ω—Ç"]);
          }
        } else if (x["—Ç–∏–ø –±–ª–æ–∫—É"] === "–≤—ñ–¥–µ–æ") {
          let video = x["–∫–æ–Ω—Ç–µ–Ω—Ç"];
          if (video.includes("drive.google.com")) {
            const match = video.match(/\/d\/([a-zA-Z0-9_-]+)/);
            if (match && match[1]) {
              video = `https://drive.google.com/file/d/${match[1]}/preview`;
              blocks += `<iframe src="${video}" style="width:100%; height:300px; border:none; border-radius:10px; margin-top:10px;" allowfullscreen></iframe>`;
              return;
            }
          }
          blocks += `<video controls style="width:100%; border-radius:10px; margin-top:10px;"><source src="${video}" type="video/mp4"></video>`;
        }
      });

      const sliderHTML = sliderImages.length ? `
        <div class="slider-container">
          <div class="swipe-hint">üì∏ –ì–æ—Ä—Ç–∞–π —Ñ–æ—Ç–æ ‚û°Ô∏è</div>
          ${sliderImages.map(src => `<img src="${src}" alt="–§–æ—Ç–æ">`).join('')}
        </div>
      ` : '';

      return `
        <div class="recipe-card">
          <h3>${r["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"]}</h3>
          <p><strong>–ß–∞—Å:</strong> ${r["—á–∞—Å –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è"] || "?"} —Ö–≤</p>
          <p><strong>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</strong> ${r["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"] || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ"}</p>
          <button class="detail-button" onclick="loadRecipeDetails('${info["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"]}', '${id}', this)">‚ûï –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</button>
          <button class="favorite-button" onclick="toggleFavorite('${r["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"]}', this)">üíõ –£ —Å–ø–∏—Å–æ–∫</button>
          <div id="${id}" class="recipe-content"></div>

          </div>
        </div>
      `;
    }).slice(0, 20); // –æ–±–º–µ–∂—É—î–º–æ –¥–æ 20

    container.innerHTML = html.join('');
  } catch (err) {
    console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–æ—à—É–∫—É:", err);
    container.innerHTML = '<p>‚ö†Ô∏è –°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –ø–æ—à—É–∫—É</p>';
  }
}


  
function toggleProInfo() {
  const el = document.getElementById('pro-info');
  el.style.display = el.style.display === 'none' ? 'block' : 'none';
}
async function submitPaymentCheck() {
  const name = document.getElementById('donate-name').value.trim();
  if (!name) {
    document.getElementById('pro-confirmation').innerHTML = '‚ùó –í–≤–µ–¥—ñ—Ç—å —ñ–º º—è –∞–±–æ —Ü–∏—Ñ—Ä–∏';
    return;
  }

  const tg = window.Telegram?.WebApp;
  if (!tg) {
    document.getElementById('pro-confirmation').innerText = '‚ùå WebApp API –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π. –ó–∞–ø—É—Å—Ç–∏ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞';
    return;
  }

  const user = tg.initDataUnsafe?.user || {};
  const user_id = user.id;
  const username = user.username || "";

  if (!user_id) {
    document.getElementById('pro-confirmation').innerHTML = '‚ùó –ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ ID. –ó–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞ —â–µ —Ä–∞–∑.';
    return;
  }

  const payload = { name, user_id, username };
  console.log("üì§ –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É:", payload);

  try {
    await fetch("https://recipe-backend-0gz1.onrender.com/notify-payment", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    localStorage.setItem('pro_verified', 'true');
    document.getElementById('pro-confirmation').innerHTML = '‚úÖ –ó–∞–ø–∏—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ. –ß–µ–∫–∞—î–º–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è‚Ä¶';

    // ‚è±Ô∏è –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–∂–Ω—ñ 5 —Å–µ–∫—É–Ω–¥
    let proInterval = setInterval(() => {
      fetch(`https://recipe-backend-0gz1.onrender.com/is-pro?user_id=${user_id}`)
        .then(res => res.json())
        .then(data => {
          if (data.is_pro) {
            clearInterval(proInterval);
            document.body.classList.add("pro-user");
            document.getElementById("pro-status").innerText = "üåü –£ —Ç–µ–±–µ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∏–π PRO –¥–æ—Å—Ç—É–ø!";
            document.getElementById("days-left").innerHTML = "üåü PRO –¥–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∏–π –¥–æ " + (data.expires || "–Ω–µ–≤—ñ–¥–æ–º–æ");
            document.getElementById("pro-confirmation").innerHTML = "üéâ –î–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ! –î—è–∫—É—î–º–æ üíõ";
          }
        });
    }, 5000);

  } catch (err) {
    document.getElementById('pro-confirmation').innerHTML = '‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ';
    console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É:", err);
  }
}

// –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫—É –ø—ñ—Å–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
window.onscroll = function() {
  const btn = document.getElementById("scrollTopBtn");
  if (document.body.scrollTop > 400 || document.documentElement.scrollTop > 400) {
    btn.style.display = "block";
  } else {
    btn.style.display = "none";
  }
};

// –ü–ª–∞–≤–Ω–µ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –≤–≥–æ—Ä—É
function scrollToTop() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
function autoScrollSliders() {
  const sliders = document.querySelectorAll('.slider-container');

  sliders.forEach(slider => {
    let scrollAmount = 0;
    let maxScroll = slider.scrollWidth - slider.clientWidth;

    function scrollStep() {
      if (scrollAmount >= maxScroll) {
        scrollAmount = 0;
        slider.scrollLeft = 0;
      } else {
        scrollAmount += 1; // –º–æ–∂–µ—à –∑–º—ñ–Ω–∏—Ç–∏ —à–≤–∏–¥–∫—ñ—Å—Ç—å (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 2 –∞–±–æ 3)
        slider.scrollLeft += 1;
      }
    }

    setInterval(scrollStep, 30); // 30 –º—Å = –ø–ª–∞–≤–Ω–æ. –ó–º–µ–Ω—à–∏—Ç–∏ ‚Üí —à–≤–∏–¥—à–µ
  });
}

 async function runSmartSearch() {
  const input = document.getElementById('smart-search-input');
  const query = input.value.trim().toLowerCase();

  if (!localStorage.getItem('all_recipes')) {
    await initAllRecipes();
  }

  const all = await fetchRecipes(); // —Ç—è–≥–Ω–µ —Ç—ñ–ª—å–∫–∏ –∑–∞—Ä–∞–∑


  const words = query
    .split(/\s+/)
    .map(normalizeWord)
    .filter(w => w.length > 2 && !stopWords.includes(w));

  const grouped = groupByRecipeNumber(all);


  const results = [];

  Object.values(grouped).forEach(group => {
    const r = group.find(x => x["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") || group[0];

    const title = (r["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"] || "").toLowerCase();
    const ingredients = (r["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"] || "").toLowerCase();
    const content = (r["–∫–æ–Ω—Ç–µ–Ω—Ç"] || "").toLowerCase();
    const fullText = `${title} ${ingredients} ${content}`;

    const normalized = new Set(
      fullText
        .replace(/[ º‚Äô'‚Äô.,;!?()\[\]]/g, '')
        .split(/\s+/)
        .map(normalizeWord)
        .filter(Boolean)
    );

    const matches = words.filter(w => normalized.has(w)).length;
    if (words.length === 0 || matches === 0) return;

    let highlightedTitle = r["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"];
    words.forEach(word => {
      const reg = new RegExp(`(${word}\\w*)`, 'gi');
      highlightedTitle = highlightedTitle.replace(reg, '<strong>$1</strong>');
    });

    const id = `smart-result-${r["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"]}-${Math.random().toString(36).substr(2, 5)}`;

    results.push(`
      <div class="recipe-card">
        <h3>${highlightedTitle}</h3>
        <p><strong>–ß–∞—Å:</strong> ${r["—á–∞—Å –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è"] || "?"} —Ö–≤</p>
        <p><strong>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</strong> ${r["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"] || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ"}</p>
        <button class="detail-button" onclick="toggleRecipe('${id}', this)">‚ûï –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</button>
        <button class="favorite-button" onclick="toggleFavorite('${r["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"]}', this)">üíõ –£ —Å–ø–∏—Å–æ–∫</button>
        <div id="${id}" class="recipe-content">
          ${(() => {
            let firstImage = null;
            let sliderImages = [];
            let blocks = "";
            const seen = new Set();

            group.forEach(x => {
              const key = `${x["—Ç–∏–ø –±–ª–æ–∫—É"]}|${x["–∫–æ–Ω—Ç–µ–Ω—Ç"]}`;
              if (seen.has(key)) return;
              seen.add(key);

              if (x["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") {
                blocks += `<p>${x["–∫–æ–Ω—Ç–µ–Ω—Ç"]}</p>`;
              } else if (x["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ñ–æ—Ç–æ") {
                if (!firstImage) {
                  firstImage = `<img src="${x["–∫–æ–Ω—Ç–µ–Ω—Ç"]}" style="max-width:100%; border-radius:10px; margin-top:10px;">`;
                } else {
                  sliderImages.push(x["–∫–æ–Ω—Ç–µ–Ω—Ç"]);
                }
              } else if (x["—Ç–∏–ø –±–ª–æ–∫—É"] === "–≤—ñ–¥–µ–æ") {
                let video = "";
                if (x["–∫–æ–Ω—Ç–µ–Ω—Ç"].includes("drive.google.com")) {
                  const match = x["–∫–æ–Ω—Ç–µ–Ω—Ç"].match(/\/d\/([a-zA-Z0-9_-]+)/);
                  if (match && match[1]) {
                    video = `<iframe src="https://drive.google.com/file/d/${match[1]}/preview" style="width:100%; height:300px; border:none; border-radius:10px; margin-top:10px;" allowfullscreen></iframe>`;
                  }
                } else {
                  video = `<video controls style="width:100%; border-radius:10px; margin-top:10px;"><source src="${x["–∫–æ–Ω—Ç–µ–Ω—Ç"]}" type="video/mp4"></video>`;
                }
                blocks += video;
              }
            });

            const sliderHTML = sliderImages.length > 0 ? `
              <div class="slider-container">
                <div class="swipe-hint">üì∏ –ì–æ—Ä—Ç–∞–π —Ñ–æ—Ç–æ ‚û°Ô∏è</div>
                ${sliderImages.map(src => `<img src="${src}" alt="–§–æ—Ç–æ">`).join('')}
              </div>` : "";

            return `${firstImage || ""}${blocks}${sliderHTML}`;
          })()}
          <div style="text-align: center; margin-top: 20px;">
            <button class="recipe-toggle" onclick="toggleRecipe('${id}', this)">üîº –ó–≥–æ—Ä–Ω—É—Ç–∏</button>
          </div>
        </div>
      </div>
    `);
  });

  const container = document.getElementById('smart-search-results');
  container.innerHTML = results.length ? results.join('') : '<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üòû</p>';
}


function cycleThreshold() {
  threshold = threshold < 4 ? threshold + 1 : 1;
  document.getElementById('threshold-btn').innerText = threshold;
}

</script>
<div id="subscribe-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
  <div style="background:white; padding:20px; border-radius:20px; max-width:300px; text-align:center; box-shadow:0 4px 20px rgba(0,0,0,0.2); animation: fade 0.4s;">
    <h2 style="color:#91326b;">üîí –ü—ñ–¥–ø–∏—Å–∫–∞ –æ–±–æ–≤ º—è–∑–∫–æ–≤–∞</h2>
    <p style="margin-top:10px; font-size:16px;">–©–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—å –±–æ—Ç–æ–º, –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª!</p>
    <button id="subscribe-btn" style="margin-top:20px; padding:10px 20px; border:none; border-radius:20px; background:linear-gradient(to right,#fbc2eb,#a6c1ee); color:#4b2c5e; font-weight:bold; cursor:pointer;">üîî –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –∫–∞–Ω–∞–ª—É</button>
  </div>
</div>
    <div id="toast" style="
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #4CAF50;
  color: white;
  padding: 12px 20px;
  border-radius: 20px;
  font-weight: bold;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  display: none;
  z-index: 9999;
  font-size: 15px;
  text-align: center;
  animation: fadeInOut 3s ease-in-out;
">
  ‚úÖ –î–æ–¥–∞–Ω–æ –¥–æ —É–ª—é–±–ª–µ–Ω–æ–≥–æ!
</div>


</body>
</html>
