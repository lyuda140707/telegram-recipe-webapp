<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–†–µ—Ü–µ–ø—Ç–ë–æ—Ç Web App</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* –°–¢–ò–õ–Ü –∑–∞–ª–∏—à–µ–Ω—ñ –±–µ–∑ –∑–º—ñ–Ω */
  </style>
</head>
<body>
  <div class="app">
    <h1>üçΩ –©–æ –ø—Ä–∏–≥–æ—Ç—É–≤–∞—Ç–∏?</h1>
    <div class="scroll-menu section active" id="section-categories"></div>
    <div class="swipe-hint">‚¨Ö –ì–æ—Ä—Ç–∞–π –º–µ–Ω—é ‚û°</div>
    <div id="daily-recipe" class="section active"></div>
    <button class="back-button" style="display:none;" onclick="goHome()">‚¨Ö –ù–∞ –≥–æ–ª–æ–≤–Ω—É</button>

    <!-- –£—Å—ñ —Å–µ–∫—Ü—ñ—ó HTML –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è —è–∫ —É —Ç–≤–æ—î–º—É –∫–æ–¥—ñ -->
    <!-- ... -->
  </div>

  <div class="bottom-nav-wrapper">
    <div class="bottom-nav" id="bottomNav">
      <button onclick="showSection('section-profile')">üë§ –ü—Ä–æ—Ñ—ñ–ª—å</button>
      <button onclick="showSection('section-buy')">üõí –©–æ –∫—É–ø–∏—Ç–∏</button>
      <button onclick="showSection('section-askbot')">ü§ñ –ê—Å–∏—Å—Ç–µ–Ω—Ç</button>
      <button onclick="showSection('section-search')">üîç –ü–æ—à—É–∫</button>
      <button onclick="showSection('section-planner')">üìÖ –ú–µ–Ω—é –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å</button>
      <button onclick="showSection('section-fridge')">‚ùÑÔ∏è –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫</button>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      if (!window.Telegram || !window.Telegram.WebApp || !Telegram.WebApp.initDataUnsafe?.user) {
        document.body.innerHTML = '<h2 style="text-align:center;padding:20px;color:#91326b;">‚ö†Ô∏è –¶–µ–π –≤–µ–±–¥–æ–¥–∞—Ç–æ–∫ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ Telegram</h2>';
        return;
      }

      Telegram.WebApp.ready();

      async function init() {
        await loadCategories();
        await loadDailyRecipe();
        goHome();
      }
      init();

      // ‚úÖ –û–î–ò–ù —Ä–∞–∑ —Å—Ç–≤–æ—Ä—é—î–º–æ –∫–Ω–æ–ø–∫—É PRO
      const proBtn = document.createElement('button');
      proBtn.innerText = "üåü –û—Ç—Ä–∏–º–∞—Ç–∏ PRO";
      proBtn.className = "main-button";
      proBtn.onclick = () => {
        window.open("https://send.monobank.ua/jar/6agGfuJmcv", "_blank");
      };
      document.getElementById("pro-button-container")?.appendChild(proBtn);

      // ‚úÖ –û–±—Ä–æ–±–Ω–∏–∫–∏ –∞–∫–æ—Ä–¥–µ–æ–Ω—ñ–≤ (–æ–¥–∏–Ω —Ä–∞–∑)
      document.getElementById('open-favorites')?.addEventListener('click', () => {
        const block = document.getElementById('fav-accordion');
        const arrow = document.getElementById('arrow-fav');
        const isOpen = block.classList.contains('accordion-open');
        block.classList.toggle('accordion-open');
        arrow.innerText = isOpen ? 'üîΩ' : 'üîº';
        if (!isOpen) {
          loadFavorites();
          setTimeout(() => {
            block.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 300);
        }
      });

      document.getElementById('open-list')?.addEventListener('click', () => {
        showSection('section-profile');
        const block = document.getElementById('list-accordion');
        const arrow = document.getElementById('arrow-list');
        const isOpen = block.classList.contains('accordion-open');
        block.classList.toggle('accordion-open');
        arrow.innerText = isOpen ? 'üîΩ' : 'üîº';
        if (!isOpen) loadCustomList();
      });

      // ‚úÖ –ü—Ä–æ–±–Ω–∞ –≤–µ—Ä—Å—ñ—è
      const start = localStorage.getItem('trial_start') || Date.now();
      localStorage.setItem('trial_start', start);
      const daysUsed = Math.floor((Date.now() - start) / (1000 * 60 * 60 * 24));
      const daysLeft = 7 - daysUsed;
      document.getElementById('days-left').innerHTML =
        localStorage.getItem('pro_verified') === 'true'
          ? 'üåü PRO –¥–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∏–π'
          : (daysLeft > 0
            ? `üîì –ü—Ä–æ–±–Ω–∞ –≤–µ—Ä—Å—ñ—è: –∑–∞–ª–∏—à–∏–ª–æ—Å—å <strong>${daysLeft} –¥–Ω${daysLeft === 1 ? '—å' : '—ñ'}</strong>`
            : `üîí –ü–ª–∞—Ç–Ω–∞ –≤–µ—Ä—Å—ñ—è –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è <strong>PRO</strong>`);

      // ‚úÖ –ü—ñ–¥–∫–∞–∑–∫–∞ "–≥–æ—Ä—Ç–∞–π –º–µ–Ω—é"
      setTimeout(() => {
        const hint = document.querySelector('.swipe-hint');
        if (hint) {
          hint.style.opacity = '0';
          hint.style.pointerEvents = 'none';
          setTimeout(() => hint.remove(), 400);
        }
      }, 30000);

      // ‚úÖ –ü—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏ –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ input
      ['section-askbot', 'section-buy', 'section-fridge', 'section-search'].forEach(sectionId => {
        const section = document.getElementById(sectionId);
        if (!section) return;
        section.addEventListener('click', (e) => {
          const isInput = e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA';
          if (!isInput) {
            document.activeElement.blur();
          }
        });
      });
    });


  
const categories = [
  "üë∂ –î–ª—è –¥—ñ—Ç–µ–π", "ü•ó –í–µ–≥–µ—Ç–∞—Ä—ñ–∞–Ω—Å—å–∫–µ", "üåæ –ë–µ–∑ –≥–ª—é—Ç–µ–Ω—É", "‚ö° –®–≤–∏–¥–∫–æ", "üç≤ –ü–µ—Ä—à—ñ —Å—Ç—Ä–∞–≤–∏",
  "ü•ò –î—Ä—É–≥—ñ —Å—Ç—Ä–∞–≤–∏", "ü•ó –°–∞–ª–∞—Ç–∏", "ü•í –ö–æ–Ω—Å–µ—Ä–≤–∞—Ü—ñ—è —Ç–∞ —Å–æ–ª—ñ–Ω–Ω—è", "ü•§ –ù–∞–ø–æ—ó", "üç∞ –î–µ—Å–µ—Ä—Ç–∏",
  "üçû –í–∏–ø—ñ—á–∫–∞", "ü•™ –ó–∞–∫—É—Å–∫–∏", "ü´ï –°–æ—É—Å–∏ —Ç–∞ –∑–∞–ø—Ä–∞–≤–∫–∏"
];

async function fetchRecipes(category = null) {
  try {
    let url = 'https://recipe-backend-0gz1.onrender.com/recipes';
    if (category) url += `?category=${encodeURIComponent(category.toLowerCase())}`;
    const response = await fetch(url);
    const data = await response.json();
    console.log("üì¶ –í—ñ–¥–ø–æ–≤—ñ–¥—å –∑ –±–µ–∫–µ–Ω–¥—É:", data);
    return data;
  } catch (e) {
    console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ:", e);
    return [];
  }
}

function groupByRecipeNumber(data) {
  const grouped = {};
  data.forEach(row => {
    const id = row["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"];
    if (!grouped[id]) grouped[id] = [];
    grouped[id].push(row);
  });
  return Object.values(grouped);
}

async function loadCategories() {
  const container = document.getElementById('section-categories');
  container.innerHTML = '';
  categories.forEach(cat => {
    const btn = document.createElement('button');
    btn.innerText = cat;
    btn.onclick = async () => {
      const cleanCategory = cat.replace(/^[^\w–∞-—è–ê-–Ø“ê“ë–Ü—ñ–á—ó–Ñ—î]+/, '').trim();
      const raw = await fetchRecipes(cleanCategory.toLowerCase());
      const grouped = groupByRecipeNumber(raw);
      renderGroupedRecipes(grouped, cat);
    };
    container.appendChild(btn);
  });
}

async function loadDailyRecipe() {
  const recipes = await fetchRecipes();
  localStorage.setItem('all_recipes', JSON.stringify(recipes));
  const container = document.getElementById('daily-recipe');

  const grouped = groupByRecipeNumber(recipes); // <-- –°–ø–æ—á–∞—Ç–∫—É —Ü–µ
  if (grouped.length === 0) return;

  const dayIndex = new Date().getDate() % grouped.length;
  const recipe = grouped[dayIndex]; // <-- –Ü —Ç–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –≤–∑—è—Ç–∏ —Ä–µ—Ü–µ–ø—Ç

  const id = `daily-details`;
  const info = recipe.find(r => r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") || recipe[0];
  const image = {
    –∫–æ–Ω—Ç–µ–Ω—Ç: "https://images.unsplash.com/photo-1505250469679-203ad9ced0cb?w=800&q=80"
  };

container.innerHTML = `
  <div class="recipe-card" style="padding: 0; overflow: hidden;">
    <div class="daily-image-wrapper" style="position: relative;">
      <img src="https://i.pinimg.com/736x/42/d0/47/42d0471e0094e28d71eaec86d78beec5.jpg"
           alt="–†–µ—Ü–µ–ø—Ç –¥–Ω—è"
           style="width:100%; height:200px; object-fit:cover; object-position: center 30%; border-radius: 16px 16px 0 0;">
      <div class="daily-label" style="
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        background: white;
        padding: 6px 14px;
        border-radius: 20px;
        font-weight: bold;
        color: #91326b;
        font-size: 14px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        animation: fadeInOut 4.5s ease forwards;
      ">–†–µ—Ü–µ–ø—Ç –¥–Ω—è üçì</div>
    </div>
    <div style="padding: 15px;">
      <h2 style="margin-top: 0;">${info["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"]}</h2>
      <p><strong>–ß–∞—Å:</strong> ${info["—á–∞—Å –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è"] || "?"} —Ö–≤</p>
      <p><strong>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</strong> ${info["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"] || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ"}</p>
      <button class="detail-button" onclick="toggleRecipe('${id}', this)">‚ûï –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</button>
      <div id="${id}" class="recipe-content"></div>

    </div>
  </div>
`;
  const block = document.getElementById(id);
  recipe.forEach(r => {
    if (r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") {
      block.innerHTML += `<p>${r["–∫–æ–Ω—Ç–µ–Ω—Ç"]}</p>`;
    } else if (r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ñ–æ—Ç–æ") {
      // –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Ñ–æ—Ç–æ –ø—ñ–¥ —Ç–µ–∫—Å—Ç–æ–º, —è–∫—â–æ —î
      block.innerHTML += `<img src="${r["–∫–æ–Ω—Ç–µ–Ω—Ç"]}" style="max-width:100%; border-radius:10px; margin-top:10px;">`;
    }
  });
  block.innerHTML += `
  <div style="text-align: center; margin-top: 20px;">
  <button class="recipe-toggle" onclick="toggleRecipe('${id}', this)">üîº –ó–≥–æ—Ä–Ω—É—Ç–∏</button>
</div>
`;
}
function renderGroupedRecipes(groups, category) {
  const container = document.getElementById('section-recipes');
  container.innerHTML = `<h2>üç¥ ${category}</h2>`;
  groups.forEach((group, index) => {
    const id = `recipe-details-${index}`;
    const info = group.find(r => r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") || group[0];
    const isFavorite = JSON.parse(localStorage.getItem('favorites') || '[]').includes(info["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"]);

    const card = document.createElement('div');
    card.className = 'recipe-card';
  
card.innerHTML = `
  <h3>${info["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"]}</h3>
  <p><strong>–ß–∞—Å:</strong> ${info["—á–∞—Å –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è"] || "?"} —Ö–≤</p>
  <p><strong>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</strong> ${info["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"] || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ"}</p>
  <div class="recipe-buttons">
    <button class="detail-button" onclick="toggleRecipe('${id}', this)">‚ûï –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</button>
    <button class="favorite-button" onclick="toggleFavorite('${info["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"]}', this)">üíõ –£ —Å–ø–∏—Å–∫—É</button>
  </div>
  <div id="${id}" class="recipe-content"></div>
`;

    container.appendChild(card);

    const block = document.getElementById(id);
 let contentAdded = false;

group.forEach(r => {
  if (r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") {
    block.innerHTML += `<p>${r["–∫–æ–Ω—Ç–µ–Ω—Ç"]}</p>`;
    contentAdded = true;
  } else if (r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ñ–æ—Ç–æ") {
    block.innerHTML += `<img src="${r["–∫–æ–Ω—Ç–µ–Ω—Ç"]}" style="max-width:100%;border-radius:10px;">`;
    contentAdded = true;
  }
});

if (contentAdded) {
  block.innerHTML += `
    <div style="text-align: center; margin-top: 20px;">
      <button class="recipe-toggle" onclick="toggleRecipe('${id}', this)">üîº –ó–≥–æ—Ä–Ω—É—Ç–∏</button>
    </div>`;
} else {
  block.innerHTML = `<p>ü§∑ –£ —Ü—å–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç—É –Ω–µ–º–∞—î –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–ø–∏—Å—É.</p>`;
}


  });
  showSection('section-recipes');
}



function toggleFavorite(recipeId, button) {
  let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
  const index = favorites.indexOf(recipeId);

  if (index === -1) {
    favorites.push(recipeId);
    button.innerText = 'üíõ –£ —Å–ø–∏—Å–∫—É';
  } else {
    favorites.splice(index, 1);
    button.innerText = '‚ù§Ô∏è –£–ª—é–±–ª–µ–Ω–µ';
  }

  button.disabled = false;
  localStorage.setItem('favorites', JSON.stringify(favorites));

  if (document.getElementById('favorites-container')) {
    loadFavorites(); // –æ–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–æ—Ñ—ñ–ª—å –ø—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
  }
}
function toggleRecipe(id, btn) {
  const el = document.getElementById(id);
  if (!el) return;
  el.classList.toggle('open');
}


function showSection(id) {
  // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –≤—Å—ñ —Å–µ–∫—Ü—ñ—ó
  document.querySelectorAll('.section').forEach(el => {
  el.classList.remove('active');
});
document.getElementById('section-categories').classList.remove('active'); // —è–≤–Ω–æ —Å—Ö–æ–≤–∞—Ç–∏
document.getElementById('daily-recipe').classList.remove('active');


  // –ê–∫—Ç–∏–≤—É—î–º–æ –ø–æ—Ç–æ—á–Ω—É
  document.getElementById(id).classList.add('active');

  // ‚úÖ –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É "‚¨Ö –ù–∞ –≥–æ–ª–æ–≤–Ω—É"
  document.querySelector('.back-button').style.display = 'block';

  // –Ø–∫—â–æ —Ü–µ "–ú–µ–Ω—é –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å" ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
  if (id === 'section-planner') {
    const saved = JSON.parse(localStorage.getItem('weekly_menu'));
    if (saved && Array.isArray(saved)) {
      renderWeeklyMenu(saved);
    }
  }

  // –Ø–∫—â–æ —Ü–µ –ø—Ä–æ—Ñ—ñ–ª—å –∞–±–æ —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤—Å–µ
  if (id === 'section-profile' || id === 'section-buy') {
    loadFavorites();
    loadCustomList();
    loadWeeklyInProfile();
  }
}


function clearWeeklyMenu() {
  localStorage.removeItem('weekly_menu');
  document.getElementById('weekly-menu-list').innerHTML = '<li>–ú–µ–Ω—é –æ—á–∏—â–µ–Ω–æ</li>';
}
  
function goHome() {
  // –ü—Ä–∏—Ö–æ–≤—É—î –≤—Å—ñ —Å–µ–∫—Ü—ñ—ó
  document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));

  // –ê–∫—Ç–∏–≤—É—î –≤–µ—Ä—Ö–Ω—î –º–µ–Ω—é –∫–∞—Ç–µ–≥–æ—Ä—ñ–π —ñ —Ä–µ—Ü–µ–ø—Ç –¥–Ω—è
  document.getElementById('section-categories').classList.add('active');
  document.getElementById('daily-recipe').classList.add('active');

  // –•–æ–≤–∞—î –∫–Ω–æ–ø–∫—É "‚¨Ö –ù–∞ –≥–æ–ª–æ–≤–Ω—É"
  document.querySelector('.back-button').style.display = 'none';

  // –ü–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î —Ä–µ—Ü–µ–ø—Ç –¥–Ω—è
  loadDailyRecipe();
}



  


  document.getElementById('open-favorites')?.addEventListener('click', () => {
    const block = document.getElementById('fav-accordion');
    const wrapper = document.getElementById('favorites-wrapper');
    const arrow = document.getElementById('arrow-fav');
    const isOpen = block.classList.contains('accordion-open');
    block.classList.toggle('accordion-open');
    arrow.innerText = isOpen ? 'üîΩ' : 'üîº';
    if (!isOpen) {
      loadFavorites();
      setTimeout(() => {
        block.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 300);
    }
  });

  document.getElementById('open-list')?.addEventListener('click', () => {
    showSection('section-profile');
    const block = document.getElementById('list-accordion');
    const wrapper = document.getElementById('custom-wrapper');
    const arrow = document.getElementById('arrow-list');
    const isOpen = block.classList.contains('accordion-open');
    block.classList.toggle('accordion-open');
    arrow.innerText = isOpen ? 'üîΩ' : 'üîº';
    if (!isOpen) loadCustomList();
  });

  const start = localStorage.getItem('trial_start') || Date.now();
  localStorage.setItem('trial_start', start);
  const daysUsed = Math.floor((Date.now() - start) / (1000 * 60 * 60 * 24));
  const daysLeft = 7 - daysUsed;
  if (localStorage.getItem('pro_verified') === 'true') {
  document.getElementById('days-left').innerHTML = 'üåü PRO –¥–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∏–π';
} else {
  document.getElementById('days-left').innerHTML =
    daysLeft > 0
      ? `üîì –ü—Ä–æ–±–Ω–∞ –≤–µ—Ä—Å—ñ—è: –∑–∞–ª–∏—à–∏–ª–æ—Å—å <strong>${daysLeft} –¥–Ω${daysLeft === 1 ? '—å' : '—ñ'}</strong>`
      : `üîí –ü–ª–∞—Ç–Ω–∞ –≤–µ—Ä—Å—ñ—è –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è <strong>PRO</strong>`;
}

});

  // üîΩ –î–∏–Ω–∞–º—ñ—á–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–û—Ç—Ä–∏–º–∞—Ç–∏ PRO"

  
// ‚úÖ –ê –æ—Å—å —Ñ—É–Ω–∫—Ü—ñ—è –ó–û–í–ù–Ü:
function toggleListSection() {
  showSection('section-profile');
  const wrapper = document.getElementById('custom-wrapper');
  const arrow = document.getElementById('arrow-list');
  const isVisible = wrapper.style.display === 'block';
  wrapper.style.display = isVisible ? 'none' : 'block';
  arrow.innerText = isVisible ? 'üîΩ' : 'üîº';
  if (!isVisible) loadCustomList();
}




async function loadFavorites() {
  const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
  const container = document.getElementById('favorites-container');
  if (!favorites.length) {
    container.innerHTML = '<p>–ù–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö —Ä–µ—Ü–µ–ø—Ç—ñ–≤</p>';
    return;
  }

  const allRecipes = await fetchRecipes();
  const grouped = groupByRecipeNumber(allRecipes);
  const filteredGroups = grouped.filter(group => {
    const info = group.find(r => r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") || group[0];
    return favorites.includes(String(info["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"]));
  });

  container.innerHTML = '';
  filteredGroups.forEach((group, index) => {
    const id = `favorite-details-${index}`; // —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID

    const info = group.find(r => r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") || group[0];
    const card = document.createElement('div');
    card.className = 'recipe-card';

    card.innerHTML = `
      <h3>${info["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"]}</h3>
      <p><strong>–ß–∞—Å:</strong> ${info["—á–∞—Å –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è"] || "?"} —Ö–≤</p>
      <p><strong>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</strong> ${info["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"] || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ"}</p>
      <div class="recipe-buttons">
        <button class="detail-button" onclick="toggleRecipe('${id}', this)">‚ûï –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</button>
        <button class="favorite-button" onclick="toggleFavorite('${info["–Ω–æ–º–µ—Ä —Ä–µ—Ü–µ–ø—Ç—É"]}', this)">üíõ –£ —Å–ø–∏—Å–∫—É</button>
      </div>
      <div id="${id}" class="recipe-content"></div>
    `;

    container.appendChild(card);

    const block = document.getElementById(id);
    group.forEach(r => {
      if (r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") {
        block.innerHTML += `<p>${r["–∫–æ–Ω—Ç–µ–Ω—Ç"]}</p>`;
      } else if (r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ñ–æ—Ç–æ") {
        block.innerHTML += `<img src="${r["–∫–æ–Ω—Ç–µ–Ω—Ç"]}" style="max-width:100%;border-radius:10px;">`;
      }
    });
  });
}

function loadCustomList() {
  const items = JSON.parse(localStorage.getItem('custom_list')) || [];

  // üîÅ 1. –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ —É –ø—Ä–æ—Ñ—ñ–ª—ñ
  const containerProfile = document.getElementById('custom-list');
  if (containerProfile) {
    containerProfile.innerHTML = '';
    if (!items.length) {
      containerProfile.innerHTML = '<li>–ü–æ—Ä–æ–∂–Ω—å–æ</li>';
    } else {
      items.forEach((item, index) => {
        const li = document.createElement('li');
            li.className = 'weekly-item';;
        li.innerHTML = `${item} <button onclick="removeFromCustomList(${index})" style="margin-left:10px; cursor:pointer;">üóë</button>`;
        containerProfile.appendChild(li);
      });
    }
  }

  // üîÅ 2. –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ —É —Å–µ–∫—Ü—ñ—ó "–©–æ –∫—É–ø–∏—Ç–∏"
  const containerBuy = document.getElementById('custom-list-buy');
  if (containerBuy) {
    containerBuy.innerHTML = '';
    if (!items.length) {
      containerBuy.innerHTML = '<li>–ü–æ—Ä–æ–∂–Ω—å–æ</li>';
    } else {
      items.forEach((item, index) => {
        const li = document.createElement('li');
        li.innerHTML = `‚Ä¢ ${item} <button onclick="removeFromCustomList(${index})" style="margin-left:10px; cursor:pointer;">üóë</button>`;
        containerBuy.appendChild(li);
      });
    }
  }
}

function addToCustomList() {
  const inputs = document.querySelectorAll('.custom-list-input');
  const input = Array.from(inputs).find(el => el.offsetParent !== null);
  if (!input) return;

  const value = input.value.trim();
  if (!value) return;

  const items = JSON.parse(localStorage.getItem('custom_list')) || [];
  items.push(value);
  localStorage.setItem('custom_list', JSON.stringify(items));
  input.value = '';
  loadCustomList();

  // ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ñ–æ–∫—É—Å—É–≤–∞–Ω–Ω—è –Ω–∞ –ø–æ–ª–µ
  setTimeout(() => input.focus(), 0);
}



function removeFromCustomList(index) {
  const items = JSON.parse(localStorage.getItem('custom_list')) || [];
  items.splice(index, 1); // –≤–∏–¥–∞–ª—è—î–º–æ –æ–±—Ä–∞–Ω–∏–π
  localStorage.setItem('custom_list', JSON.stringify(items));
  loadCustomList(); // –æ–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
} // ‚Üê ‚úÖ –æ—Ü–µ –±—É–ª–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
function toggleWeeklyInProfile() {
  showSection('section-planner'); // –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—É—î–º–æ –æ—Å–Ω–æ–≤–Ω—É —Å–µ–∫—Ü—ñ—é –º–µ–Ω—é
}



function loadWeeklyInProfile() {
  const list = document.getElementById('weekly-list-profile');
  const saved = JSON.parse(localStorage.getItem("weekly_menu")) || [];

  list.innerHTML = saved.length
    ? saved.map(item => `<li><strong>${item.day}:</strong> ${item.category}</li>`).join('')
    : '<li>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ</li>';
}


setTimeout(() => {
  const hint = document.querySelector('.swipe-hint');
  if (hint) {
    hint.style.opacity = '0';
    hint.style.pointerEvents = 'none';
    setTimeout(() => hint.remove(), 400);
  }
}, 30000); // 10 —Å–µ–∫—É–Ω–¥

// ‚úÖ –í–ò–ù–ï–°–ï–ù–ê –ó–û–í–ù–Ü –§–£–ù–ö–¶–Ü–Ø:
async function loadRecipesForDay(day, category, container) {
  const data = await fetchRecipes(category.toLowerCase());
  const grouped = groupByRecipeNumber(data);
  const recipe = grouped[0];
  if (!recipe) {
    container.innerHTML = "<p>–ù–µ–º–∞—î —Ä–µ—Ü–µ–ø—Ç—ñ–≤ üòû</p>";
    return;
  }

  const info = recipe.find(r => r["—Ç–∏–ø –±–ª–æ–∫—É"] === "—Ç–µ–∫—Å—Ç") || recipe[0];
  container.innerHTML = `
    <div class="recipe-card">
      <h3>${info["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"]}</h3>
      <p><strong>–ß–∞—Å:</strong> ${info["—á–∞—Å –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è"] || "?"} —Ö–≤</p>
      <p><strong>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</strong> ${info["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"] || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ"}</p>
    </div>
  `;

}

function generateWeeklyMenu() {
  const categories = [
    "–ü–µ—Ä—à—ñ —Å—Ç—Ä–∞–≤–∏", "–î—Ä—É–≥—ñ —Å—Ç—Ä–∞–≤–∏", "–°–∞–ª–∞—Ç–∏", "–î–µ—Å–µ—Ä—Ç–∏", "–í–∏–ø—ñ—á–∫–∞", "–ó–∞–∫—É—Å–∫–∏", "–ù–∞–ø–æ—ó"
  ];
  const days = ["–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°–±", "–ù–¥"];
  const list = [];

  days.forEach(day => {
    const randomCategory = categories[Math.floor(Math.random() * categories.length)];
    list.push({ day, category: randomCategory });
  });

  // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ localStorage
  localStorage.setItem("weekly_menu", JSON.stringify(list));
  renderWeeklyMenu(list);
}
function renderWeeklyMenu(menu) {
  const container = document.getElementById('weekly-menu-list');
  container.innerHTML = '';

  const allCategories = [
    "–ü–µ—Ä—à—ñ —Å—Ç—Ä–∞–≤–∏", "–î—Ä—É–≥—ñ —Å—Ç—Ä–∞–≤–∏", "–°–∞–ª–∞—Ç–∏", "–î–µ—Å–µ—Ä—Ç–∏",
    "–í–∏–ø—ñ—á–∫–∞", "–ó–∞–∫—É—Å–∫–∏", "–ù–∞–ø–æ—ó"
  ];

  menu.forEach((item, index) => {
   const li = document.createElement('li');
    li.className = 'weekly-item';
    const select = document.createElement('select');
    const recipeContainer = document.createElement('div'); // üü¢ –ø–µ—Ä–µ–Ω–µ—Å–ª–∏ —Å—é–¥–∏!

    recipeContainer.className = 'recipe-card hidden';
    recipeContainer.id = `${item.day}-${index}`;

    allCategories.forEach(cat => {
      const option = document.createElement('option');
      option.value = cat;
      option.textContent = cat;
      if (cat === item.category) option.selected = true;
      select.appendChild(option);
    });

    select.onchange = () => {
      updateMenuCategory(index, select.value);
      loadRecipesForDay(item.day, select.value, recipeContainer); // ‚úÖ —Ç–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—î
    };

    const dayIcons = {
  '–ü–Ω': 'üåû', '–í—Ç': 'üåø', '–°—Ä': 'ü•ï', '–ß—Ç': 'üçÖ',
  '–ü—Ç': 'üçù', '–°–±': 'üç∞', '–ù–¥': '‚òï'
};
li.innerHTML = `<strong>${dayIcons[item.day] || ''} ${item.day}:</strong> `;

    li.appendChild(select);

    const toggleBtn = document.createElement('button');
    toggleBtn.className = 'recipe-toggle';
    toggleBtn.innerHTML = '<span class="rotate-toggle">üîΩ</span> –ó–≥–æ—Ä–Ω—É—Ç–∏';
    toggleBtn.onclick = () => toggleRecipe(`${item.day}-${index}`, toggleBtn);

    li.appendChild(toggleBtn);
    li.appendChild(recipeContainer);
    container.appendChild(li);

    loadRecipesForDay(item.day, item.category, recipeContainer);
  });
}

  function normalizeWord(word) {
  const endings = ['–∏', '—ñ', '—è', '–∞', '—É', '—é', '–µ', '–æ', '—å', '–µ–π', '—ñ–≤', '–µ–º', '–∞–º', '—è–º'];
  for (const end of endings) {
    if (word.endsWith(end) && word.length > end.length + 2) {
      return word.slice(0, -end.length);
    }
  }
  return word;
}

  function searchFridge() {
  const input = document.getElementById('fridge-input').value.toLowerCase();
  const fridgeItems = input.split(/[\s,]+/).map(i => i.trim()).filter(Boolean);
  const normFridgeItems = fridgeItems.map(normalizeWord);
  const results = [];
  const all = JSON.parse(localStorage.getItem('all_recipes')) || [];

  all.forEach(r => {
    const rawIngredients = (r["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"] || "").toLowerCase();
    const normalizedIngredients = rawIngredients
      .split(/[,\n]+/)
      .map(i => normalizeWord(i.trim()))
      .join(' ');

    const ingredientWords = new Set(normalizedIngredients.split(/\s+/));
    const matches = normFridgeItems.filter(i => ingredientWords.has(i)).length;
    const threshold = parseInt(document.getElementById('match-threshold').value, 10);
    if (matches >= threshold) {
      // –ü—ñ–¥—Å–≤—ñ—á—É—î–º–æ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏
      let highlighted = r["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"];
      fridgeItems.forEach(word => {
        const normWord = normalizeWord(word);
        const regex = new RegExp(`(${normWord}\\w*)`, 'gi');
        highlighted = highlighted.replace(regex, '<strong>$1</strong>');
      });

      results.push({
        ...r,
        matches,
        hasFirst: ingredientWords.has(normFridgeItems[0]),
        highlighted
      });
    }
  });

  results.sort((a, b) => {
    if (b.hasFirst !== a.hasFirst) return b.hasFirst - a.hasFirst;
    return b.matches - a.matches;
  });

  const container = document.getElementById('fridge-results');
  container.innerHTML = results.length
    ? results.map(r => {
        let title = r["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"];
        fridgeItems.forEach(word => {
          const normWord = normalizeWord(word);
          const regex = new RegExp(`(${normWord}\\w*)`, 'gi');
          title = title.replace(regex, '<strong>$1</strong>');
        });

        return `<div class="recipe-card">
  <h3>${title}</h3>
  <p>${r["highlighted"]}</p>
  <p><em>üîç –ó–±—ñ–≥—ñ–≤: <strong>${r.matches}</strong></em></p>
</div>`;

      }).join('')
    : '<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üòû</p>';
}

function updateMenuCategory(index, newValue) {
  const menu = JSON.parse(localStorage.getItem('weekly_menu')) || [];
  if (menu[index]) {
    menu[index].category = newValue.trim();
    localStorage.setItem('weekly_menu', JSON.stringify(menu));
  }
}
  function askBot() {
  const query = document.getElementById('bot-query').value.trim().toLowerCase();
  const all = JSON.parse(localStorage.getItem('all_recipes')) || [];
  const results = [];

  all.forEach(r => {
    const text = `${r["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"]} ${r["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"]} ${r["–∫–æ–Ω—Ç–µ–Ω—Ç"]}`.toLowerCase();
    if (text.includes(query)) results.push(r);
  });

  const container = document.getElementById('bot-response');
  if (!query) {
    container.innerHTML = '<p>–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∑–∞–ø–∏—Ç üôÉ</p>';
    return;
  }

  container.innerHTML = results.length
    ? results.map(r => `
        <div class="recipe-card">
          <h3>${r["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"]}</h3>
          <p><strong>–ß–∞—Å:</strong> ${r["—á–∞—Å –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è"] || "?"} —Ö–≤</p>
          <p><strong>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</strong> ${r["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"] || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ"}</p>
        </div>
      `).join('')
    : '<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üòû</p>';
}
  function normalizeWord(word) {
  const endings = ['–∏', '—ñ', '—è', '–∞', '—É', '—é', '–µ', '–æ', '—å', '–µ–π', '—ñ–≤', '–µ–º', '–∞–º', '—è–º'];
  for (const end of endings) {
    if (word.endsWith(end) && word.length > end.length + 2) {
      return word.slice(0, -end.length);
    }
  }
  return word;
}

function runSmartSearch() {
  const query = document.getElementById('smart-search-input').value.toLowerCase();
  const all = JSON.parse(localStorage.getItem('all_recipes')) || [];
  const words = query.split(/\s+/).map(normalizeWord).filter(Boolean);
  const results = [];

  all.forEach(r => {
    const name = (r["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"] || "").toLowerCase();
    const normName = name.split(/\s+/).map(normalizeWord);
    const matches = words.filter(w => normName.includes(w)).length;
    if (matches > 0) {
      let title = r["–Ω–∞–∑–≤–∞ —Ä–µ—Ü–µ–ø—Ç—É"];
      words.forEach(word => {
        const reg = new RegExp(`(${word}\\w*)`, 'gi');
        title = title.replace(reg, '<strong>$1</strong>');
      });

      results.push(`
        <div class="recipe-card">
          <h3>${title}</h3>
          <p><strong>–ß–∞—Å:</strong> ${r["—á–∞—Å –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è"] || "?"} —Ö–≤</p>
          <p><strong>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</strong> ${r["—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"] || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ"}</p>
        </div>
      `);
    }
  });

  const container = document.getElementById('smart-search-results');
  container.innerHTML = results.length ? results.join('') : '<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üòû</p>';
}

function toggleProInfo() {
  const el = document.getElementById('pro-info');
  el.style.display = el.style.display === 'none' ? 'block' : 'none';
}
function submitPaymentCheck() {
  const value = document.getElementById('donate-name').value.trim();
  if (!value) {
    document.getElementById('pro-confirmation').innerHTML = '‚ùó –í–≤–µ–¥—ñ—Ç—å —ñ–º º—è –∞–±–æ —Ü–∏—Ñ—Ä–∏';
    return;
  }

  localStorage.setItem('pro_verified', 'true');
  document.getElementById('pro-confirmation').innerHTML = 'üéâ –î—è–∫—É—î–º–æ! PRO –¥–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ ‚úÖ';
}


</script>

</body>
</html>
